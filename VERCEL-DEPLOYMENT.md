# 部署到Vercel生产环境

## 环境配置

### 环境变量设置
在 Vercel 项目的 `Settings -> Environment Variables` 中添加：

| 变量名 | 说明 | 示例 |
|-------|------|------|
| `VITE_ADMIN_USER` | 管理员账号 | admin |
| `VITE_ADMIN_PASS` | 管理员密码 | 您的强密码 |
| `DB_TYPE` | 数据库类型 (memory, neon) | neon (生产环境) |
| `NEON_CONNECTION_STRING` | Neon数据库连接字符串 (当DB_TYPE=neon时) | `postgresql://username:password@ep-xxx.ap-southeast-1.aws.neon.tech/dbname?sslmode=require` |
| `VITE_APP_URL` | 应用URL，用于二维码生成 (可选) | https://your-app.vercel.app |

## 部署步骤

### 1. 部署到Vercel
1. 在GitHub中创建新仓库并推送代码
2. 在Vercel中导入项目
3. 设置环境变量
4. 部署应用

### 2. 初始化生产数据
部署完成后：
1. 访问系统设置面板
2. 点击"状态检查"确认数据库连接正常
3. 点击"初始化系统数据"创建基础数据（需要认证）

### 3. 数据验证
- 系统将自动创建以下数据表和初始数据：
  - 酒店房间：64个房间（8201-8232, 8301-8332）
  - KTV房间：1个房间
  - 菜品：8个示例菜品
  - 支付方式：5种支付方式
  - 库存：5个库存项目
  - 签单账户：2个示例账户
  - 系统设置：默认配置

## 数据库切换

### 从内存数据库切换到Neon数据库
1. 更新环境变量 `DB_TYPE=neon`
2. 重启应用
3. 运行数据迁移（如果需要从现有内存数据迁移）

### 数据迁移
如果需要从内存数据库迁移到Neon数据库：
1. 确保Neon连接字符串正确配置
2. 调用 `/api/migrate` 端点（需要认证）
3. 确认数据迁移成功

## 安全注意事项
- 生产环境务必使用强密码
- 定期备份数据库
- 监控API访问日志
- 使用HTTPS连接
- CORS 配置限制为正式域名：https://www.jiangxijiudian.store/
- 移除开发环境自动认证功能，强制使用正式认证流程
- 敏感数据自动脱敏处理
- API 访问速率限制（如需要）

## 运维操作
- 数据同步：通过设置面板一键同步
- 数据备份：自动关联Git Commit Hash
- 操作审计：记录所有敏感操作
- 状态监控：实时检查数据库连接状态
- 性能监控：监控API响应时间和数据库操作性能
- 错误监控：生产环境错误自动记录和告警
- 日志管理：生产环境日志脱敏和过滤

## 监控和告警
- API 性能监控：响应时间超过2秒发出警告
- 数据库性能监控：操作时间超过1秒发出警告
- 错误率监控：错误率超过阈值时告警
- 登录失败监控：多次失败登录尝试告警
- 系统健康检查：定期检查系统状态

## 生产环境配置验证
部署完成后，执行以下验证步骤：
1. 访问 `https://www.jiangxijiudian.store/api/test-connection` 验证数据库连接
2. 确认 CORS 配置正确，仅允许正式域名访问
3. 验证认证功能正常工作
4. 检查监控服务正常运行
5. 确认日志脱敏功能正常