# æ±Ÿè¥¿é…’åº—ç®¡ç†ç³»ç»Ÿ

é…’åº—é¤é¥®æœåŠ¡ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒå®¢æˆ¿é€é¤ã€èœå•ç®¡ç†ã€è®¢å•å¤„ç†ã€è´¢åŠ¡ç®¡ç†ã€‚

## æŠ€æœ¯æ¶æ„

**No-Build + importmap æ¶æ„**

- å‰ç«¯ä¾èµ–é€šè¿‡ `importmap` ä» esm.sh CDN åŠ è½½
- Vite ä»…ç”¨äº TSX è½¬è¯‘ï¼Œä¸æ‰“åŒ…ä¾èµ–
- æ„å»ºäº§ç‰©æå°ï¼ˆä¸»JS ~35KB gzip ~12KBï¼‰
- éƒ¨ç½²äº Vercel è¾¹ç¼˜ç½‘ç»œ

## æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ | è¯´æ˜ |
|------|------|------|
| å‰ç«¯æ¡†æ¶ | React 18 + TypeScript | ç±»å‹å®‰å…¨çš„ç»„ä»¶åŒ–å¼€å‘ |
| æ ·å¼ | Tailwind CSS (CDN) | åŸå­åŒ– CSSï¼Œé›¶æ„å»º |
| å›¾æ ‡ | Lucide React | ç°ä»£åŒ–å›¾æ ‡åº“ |
| å›¾è¡¨ | Recharts | æ•°æ®å¯è§†åŒ– |
| æ‹–æ‹½ | @dnd-kit | æ‹–æ‹½æ’åº |
| HTTP | Axios | HTTP å®¢æˆ·ç«¯ |
| åç«¯ | Vercel Serverless (Edge Runtime) | å…¨çƒè¾¹ç¼˜è®¡ç®— |
| æ•°æ®åº“ | **Upstash Redis** | **REST API for Edge** |

### ğŸš€ Upstash Redis - è¾¹ç¼˜è®¡ç®—çš„å®Œç¾é€‰æ‹©

Upstash æ˜¯åç«¯é©±åŠ¨å‹ UI ç”Ÿæ€ç³»ç»Ÿä¸­çš„å…³é”®ç»„æˆéƒ¨åˆ†ï¼Œç‰¹åˆ«é€‚åˆ Vercel Edge Runtimeï¼š

**ä¸ºä»€ä¹ˆé€‰æ‹© Upstashï¼Ÿ**
- âœ… **REST-based API**ï¼šé€šè¿‡ HTTP è®¿é—® Redisï¼Œå®Œç¾å…¼å®¹ Edge Functions
- âœ… **æ—  TCP è¿æ¥é—®é¢˜**ï¼šä¼ ç»Ÿ Redis éœ€è¦é•¿è¿æ¥ï¼Œåœ¨ Serverless ç¯å¢ƒä¼šè¶…æ—¶
- âœ… **å…¨çƒä½å»¶è¿Ÿ**ï¼šæ•°æ®è‡ªåŠ¨å¤åˆ¶åˆ°å¤šä¸ªåŒºåŸŸ
- âœ… **æŒ‰éœ€è®¡è´¹**ï¼šæ— éœ€ç»´æŠ¤ Redis æœåŠ¡å™¨
- âœ… **Vercel åŸç”Ÿé›†æˆ**ï¼šä¸€é”®åˆ›å»ºï¼Œç¯å¢ƒå˜é‡è‡ªåŠ¨æ³¨å…¥

**æŠ€æœ¯å¯¹æ¯”ï¼š**
```typescript
// âŒ ä¼ ç»Ÿ Redisï¼ˆTCP è¿æ¥ï¼ŒEdge Runtime ä¸å…¼å®¹ï¼‰
import Redis from 'ioredis';
const redis = new Redis('redis://...');

// âœ… Upstash Redisï¼ˆREST APIï¼ŒEdge Runtime å®Œç¾æ”¯æŒï¼‰
import { Redis } from '@upstash/redis';
const redis = new Redis({
  url: process.env.KV_REST_API_URL,
  token: process.env.KV_REST_API_TOKEN,
});
```

**æ€§èƒ½è¡¨ç°ï¼š**
- å¹³å‡å“åº”æ—¶é—´ï¼š10-50msï¼ˆå…¨çƒè¾¹ç¼˜èŠ‚ç‚¹ï¼‰
- å†·å¯åŠ¨ï¼š< 100ms
- å¹¶å‘èƒ½åŠ›ï¼šè‡ªåŠ¨æ‰©å±•

## é¡¹ç›®ç»“æ„

```
â”œâ”€â”€ api/
â”‚   â””â”€â”€ index.ts         # å”¯ä¸€ Edge Runtime APIï¼ˆREST æ¥å£ï¼‰
â”œâ”€â”€ components/          # React ç»„ä»¶
â”œâ”€â”€ hooks/               # React Hooks
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ kv-client.ts     # Upstash Redis å®¢æˆ·ç«¯æ ¸å¿ƒåº“
â”œâ”€â”€ services/            # æœåŠ¡å±‚
â”œâ”€â”€ utils/               # å·¥å…·å‡½æ•°
â”œâ”€â”€ src/                 # é…ç½®
â”œâ”€â”€ public/              # é™æ€èµ„æº
â”œâ”€â”€ index.html           # å…¥å£ + importmap
â”œâ”€â”€ index.tsx            # React å…¥å£
â”œâ”€â”€ App.tsx              # ä¸»ç»„ä»¶
â”œâ”€â”€ vercel.json          # Vercel éƒ¨ç½²é…ç½®
â””â”€â”€ vite.config.ts       # Vite æ„å»ºé…ç½®
```

### æ¶æ„äº®ç‚¹

**æç®€åˆ†å±‚è®¾è®¡ï¼š**
- `/api/index.ts` - Edge Runtime API ç«¯ç‚¹ï¼ˆå¤„ç† HTTP è¯·æ±‚ï¼‰
- `/lib/kv-client.ts` - æ•°æ®è®¿é—®å±‚ï¼ˆå°è£… Redis æ“ä½œï¼‰
- æ— ä¸­é—´å±‚ï¼Œç›´æ¥å¯¼å…¥ï¼Œå‡å°‘ç»´æŠ¤æˆæœ¬

**å…³é”®æŠ€æœ¯å†³ç­–ï¼š**
- âœ… åˆ é™¤å†—ä½™æ–‡ä»¶ï¼ˆkv-index.tsã€unified-index.tsã€db.tsã€storage-manager.tsï¼‰
- âœ… Edge Runtime é€šè¿‡ä»£ç å£°æ˜ï¼ˆ`export const config = { runtime: 'edge' }`ï¼‰
- âœ… è·¯ç”±é…ç½®ä½¿ç”¨è´Ÿå‘é¢„æŸ¥æ’é™¤ API è·¯å¾„ï¼ˆ`/:path((?:(?!api).)*)`ï¼‰
- âœ… ESM å¯¼å…¥æ˜¾å¼æ‰©å±•åï¼ˆç¬¦åˆ TypeScript node16 æ¨¡å—è§£æï¼‰

## å¼€å‘å‘½ä»¤

```bash
# æœ¬åœ°å¼€å‘ï¼ˆéœ€è¿æ¥çœŸå®æ•°æ®åº“ï¼‰
vercel dev

# æ„å»º
npm run build

# é¢„è§ˆ
npm run preview
```

## éƒ¨ç½²

### éƒ¨ç½²æµç¨‹

**åŸºæœ¬æ­¥éª¤ï¼š**
1. æ¨é€ä»£ç åˆ° GitHub
2. Vercel è‡ªåŠ¨æ£€æµ‹å¹¶æ„å»º
3. éƒ¨ç½²åˆ°å…¨çƒè¾¹ç¼˜èŠ‚ç‚¹

**é‡è¦è¯´æ˜ï¼š**
- âœ… æ— éœ€æœ¬åœ° `node_modules`ï¼Œæ‰€æœ‰ä¾èµ–é€šè¿‡ CDN åŠ è½½
- âœ… ä¸éœ€è¦æœ¬åœ°è¿è¡Œ `npm install` æˆ– `npm run dev`
- âœ… ç›´æ¥æ¨é€ä»£ç ï¼ŒVercel è‡ªåŠ¨å¤„ç†æ„å»º

---

### 1. åˆ›å»º Vercel KV å­˜å‚¨ï¼ˆUpstash Redisï¼‰

1. ç™»å½• [Vercel Dashboard](https://vercel.com/dashboard)
2. è¿›å…¥ä½ çš„é¡¹ç›®
3. ç‚¹å‡» **Storage** â†’ **Create Database** â†’ é€‰æ‹© **KV**
4. Vercel ä¼šè‡ªåŠ¨åˆ›å»º Upstash Redis å®ä¾‹
5. ç¯å¢ƒå˜é‡è‡ªåŠ¨æ³¨å…¥ï¼š
   - `KV_REST_API_URL`
   - `KV_REST_API_TOKEN`
   - `KV_URL`

### 2. é…ç½®å…¶ä»–ç¯å¢ƒå˜é‡

åœ¨ Vercel é¡¹ç›®è®¾ç½®ä¸­æ·»åŠ ï¼š
- `VITE_ADMIN_USER` - ç®¡ç†å‘˜ç”¨æˆ·å
- `VITE_ADMIN_PASS` - ç®¡ç†å‘˜å¯†ç 

### 3. æ¨é€éƒ¨ç½²

```bash
git push origin main
```

Vercel ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶æ„å»ºéƒ¨ç½²ã€‚

### 4. éªŒè¯éƒ¨ç½²

è®¿é—® `https://your-app.vercel.app/api` æŸ¥çœ‹ KV è¿æ¥çŠ¶æ€ï¼š
```json
{
  "success": true,
  "message": "Jiangxi Hotel Management System API",
  "kvStatus": {
    "connected": true,
    "hasUrl": true,
    "hasToken": true
  }
}
```

## ç¯å¢ƒå˜é‡

å¤åˆ¶ `.env.local.template` ä¸º `.env.local` å¹¶å¡«å…¥å®é™…å€¼ã€‚

## å¸¸è§é—®é¢˜

### 1. TypeScript é”™è¯¯ï¼šæ‰¾ä¸åˆ°æ¨¡å—

**é—®é¢˜ï¼š** VS Code æ˜¾ç¤º "æ‰¾ä¸åˆ°æ¨¡å— 'vite' æˆ–å…¶ç›¸åº”çš„ç±»å‹å£°æ˜"

**è§£å†³ï¼š** è¿™æ˜¯æ­£å¸¸ç°è±¡ï¼Œå¯ä»¥å¿½ç•¥ã€‚é¡¹ç›®ä¸éœ€è¦æœ¬åœ° `node_modules`ï¼ŒVercel æ„å»ºæ—¶ä¼šè‡ªåŠ¨å®‰è£…ä¾èµ–ã€‚

### 2. Vercel éƒ¨ç½²å¤±è´¥

**å¸¸è§é”™è¯¯åŠè§£å†³ï¼š**

| é”™è¯¯ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| Function Runtimes ç‰ˆæœ¬é”™è¯¯ | åœ¨ vercel.json ä¸­é…ç½®äº† functions | åˆ é™¤ functions é…ç½®ï¼ŒEdge Runtime é€šè¿‡ä»£ç å£°æ˜ |
| æ— æ•ˆçš„è·¯ç”±æ¨¡å¼ | æ­£åˆ™è¡¨è¾¾å¼è¯­æ³•é”™è¯¯ | è´Ÿå‘é¢„æŸ¥å¿…é¡»åœ¨éæ•è·ç»„ä¸­ï¼š`/:path((?:(?!api).)*)`  |
| ESM å¯¼å…¥é”™è¯¯ | ç¼ºå°‘æ–‡ä»¶æ‰©å±•å | ç›¸å¯¹å¯¼å…¥å¿…é¡»åŒ…å« `.js` æ‰©å±•å |

### 3. KV æ•°æ®åº“è¿æ¥å¤±è´¥

**æ£€æŸ¥æ­¥éª¤ï¼š**
1. è®¿é—® `/api` æŸ¥çœ‹ `kvStatus` å­—æ®µ
2. ç¡®è®¤ Vercel Dashboard ä¸­å·²åˆ›å»º KV å®ä¾‹
3. æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦è‡ªåŠ¨æ³¨å…¥
4. å°è¯• Redeploy é‡æ–°éƒ¨ç½²

## æ€§èƒ½æŒ‡æ ‡

- **æ„å»ºäº§ç‰©å¤§å°**ï¼š~35KB (gzip ~12KB)
- **API å“åº”æ—¶é—´**ï¼š10-50msï¼ˆå…¨çƒè¾¹ç¼˜èŠ‚ç‚¹ï¼‰
- **å†·å¯åŠ¨æ—¶é—´**ï¼š< 100ms
- **å¹¶å‘èƒ½åŠ›**ï¼šè‡ªåŠ¨æ‰©å±•
- **ä»£ç è¡Œæ•°**ï¼šå‡å°‘ 538 è¡Œå†—ä½™ä»£ç ï¼ˆä¼˜åŒ–åï¼‰

## è®¸å¯è¯

ä¸“æœ‰è½¯ä»¶ï¼Œç‰ˆæƒæ‰€æœ‰ã€‚
