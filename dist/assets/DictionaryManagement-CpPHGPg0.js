import{jsx as e,jsxs as a}from"react/jsx-runtime";import{useState as h,useEffect as I}from"react";import{Plus as L,Search as M,Filter as U,Edit3 as Y,Trash2 as X,X as D,Save as F}from"lucide-react";import{dbManager as u}from"./database-sHUWp0Re.js";import{a as w}from"./auditLogger-DYWE_lBP.js";const b={async getDictionaryEntries(r){let n=await u.getDatabase().getAll("system_dictionary");if(r&&(r.category&&(n=n.filter(s=>s.category===r.category)),r.key_code&&(n=n.filter(s=>s.key_code===r.key_code)),r.search)){const s=r.search.toLowerCase();n=n.filter(i=>i.key_code.toLowerCase().includes(s)||i.zh_cn.toLowerCase().includes(s)||i.en_ph.toLowerCase().includes(s)||i.description&&i.description.toLowerCase().includes(s))}return n},async getDictionaryEntry(r){return await u.getDatabase().get(`system_dictionary:${r}`)},async createDictionaryEntry(r){const c=u.getDatabase(),n={...r,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return await c.create("system_dictionary",n)},async updateDictionaryEntry(r,c){const n=u.getDatabase(),s=await n.get(`system_dictionary:${r}`);if(!s)throw new Error(`Dictionary entry with key_code ${r} not found`);const i={...s,...c,key_code:r,updatedAt:new Date().toISOString()};return await n.update("system_dictionary",r,i)},async deleteDictionaryEntry(r){return await u.getDatabase().remove("system_dictionary",r)},async initializeDefaultDictionary(){const r=u.getDatabase();if((await r.getAll("system_dictionary")).length>0)return;const n=[{key_code:"ORDER_PENDING",category:"STATUS",zh_cn:"待接单",en_ph:"Pending / New Order",description:"H5刚下的单"},{key_code:"ORDER_PROCESSING",category:"STATUS",zh_cn:"制作中",en_ph:"Kitchen Processing",description:"厨房正在做"},{key_code:"ORDER_DELIVERED",category:"STATUS",zh_cn:"已送达",en_ph:"Order Delivered",description:"菜已上齐"},{key_code:"ORDER_COMPLETED",category:"STATUS",zh_cn:"已结账",en_ph:"Completed / Paid",description:"钱已收到"},{key_code:"ORDER_VOID",category:"STATUS",zh_cn:"已作废",en_ph:"Voided / Cancelled",description:"异常订单处理"},{key_code:"PAY_CASH",category:"PAYMENT",zh_cn:"现金支付",en_ph:"Cash Payment",description:"现金收银"},{key_code:"PAY_GCASH",category:"PAYMENT",zh_cn:"GCash转账",en_ph:"GCash / E-Wallet",description:"电子支付"},{key_code:"PAY_MAYA",category:"PAYMENT",zh_cn:"Maya支付",en_ph:"Maya Payment",description:"电子支付"},{key_code:"PAY_CHARGE",category:"PAYMENT",zh_cn:"签单挂账",en_ph:"Charge to Account",description:"合作单位挂账"},{key_code:"PAY_ROOM",category:"PAYMENT",zh_cn:"房费合并",en_ph:"Charge to Room",description:"客人退房再付"},{key_code:"BTN_CHECKOUT",category:"UI",zh_cn:"收银结算",en_ph:"Pay / Checkout",description:"收钱按钮"},{key_code:"BTN_SHIFT",category:"UI",zh_cn:"交班报告",en_ph:"End Shift / Report",description:"换班结算"},{key_code:"BTN_EXPENSE",category:"UI",zh_cn:"记录支出",en_ph:"Add Expense",description:"记一笔开销"},{key_code:"BTN_VOID",category:"UI",zh_cn:"作废订单",en_ph:"Void Order",description:"删单理由弹出"},{key_code:"BTN_CONFIRM",category:"UI",zh_cn:"确认接单",en_ph:"Confirm Order",description:"订单中心操作"},{key_code:"EXP_MARKET",category:"EXPENSE",zh_cn:"买菜采购",en_ph:"Market / Ingredients",description:"厨房支出"},{key_code:"EXP_REPAIR",category:"EXPENSE",zh_cn:"维修费用",en_ph:"Maintenance / Repair",description:"设施维护"},{key_code:"EXP_UTILITY",category:"EXPENSE",zh_cn:"水电杂费",en_ph:"Utilities / Bills",description:"杂项开支"},{key_code:"EXP_REFUND",category:"EXPENSE",zh_cn:"客服退款",en_ph:"Refund to Customer",description:"异常退款"}];for(const s of n)await r.create("system_dictionary",{...s,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()})}},K=()=>{const[r,c]=h([]),[n,s]=h(!0),[i,g]=h(null),[C,f]=h(!1),[m,v]=h(null),[p,S]=h(""),[x,z]=h(""),[d,N]=h({key_code:"",category:"",zh_cn:"",en_ph:"",description:""});I(()=>{A()},[]);const A=async()=>{try{s(!0);const t=await b.getDictionaryEntries();c(t)}catch(t){console.error("加载词库失败:",t),g("加载词库失败")}finally{s(!1)}},_=t=>{const{name:o,value:l}=t.target;N(y=>({...y,[o]:l}))},P=async t=>{t.preventDefault();try{if(m){const o=await b.updateDictionaryEntry(m.key_code,d);c(l=>l.map(y=>y.key_code===m.key_code?o:y)),w.log("dictionary_updated",{key_code:m.key_code,user:"current_user"})}else{const o=await b.createDictionaryEntry(d);c(l=>[...l,o]),w.log("dictionary_created",{key_code:d.key_code,user:"current_user"})}E()}catch(o){console.error("保存词库条目失败:",o),g("保存词库条目失败")}},T=t=>{v(t),N({key_code:t.key_code,category:t.category,zh_cn:t.zh_cn,en_ph:t.en_ph,description:t.description||""}),f(!0)},R=async t=>{if(window.confirm("确定要删除这个词库条目吗？"))try{await b.deleteDictionaryEntry(t)&&(c(l=>l.filter(y=>y.key_code!==t)),w.log("dictionary_deleted",{key_code:t,user:"current_user"}))}catch(o){console.error("删除词库条目失败:",o),g("删除词库条目失败")}},E=()=>{N({key_code:"",category:"",zh_cn:"",en_ph:"",description:""}),v(null),f(!1),g(null)},k=r.filter(t=>{const o=!p||t.key_code.toLowerCase().includes(p.toLowerCase())||t.zh_cn.toLowerCase().includes(p.toLowerCase())||t.en_ph.toLowerCase().includes(p.toLowerCase())||t.description&&t.description.toLowerCase().includes(p.toLowerCase()),l=!x||t.category===x;return o&&l}),O=Array.from(new Set(r.map(t=>t.category)));return n?e("div",{className:"flex items-center justify-center p-8",children:e("div",{className:"text-slate-500",children:"加载词库中..."})}):a("div",{className:"space-y-6",children:[a("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[a("div",{children:[e("h1",{className:"text-2xl font-bold text-slate-900",children:"词库管理"}),e("p",{className:"text-slate-600",children:"管理系统翻译词典"})]}),a("button",{onClick:()=>f(!0),className:"mt-4 flex items-center gap-2 rounded bg-blue-600 px-4 py-2 text-white hover:bg-blue-700 sm:mt-0",children:[e(L,{size:18}),"添加词条"]})]}),e("div",{className:"rounded-lg bg-white p-4 shadow",children:a("div",{className:"flex flex-col gap-4 md:flex-row",children:[a("div",{className:"relative flex-1",children:[e(M,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:18}),e("input",{type:"text",placeholder:"搜索关键词、中文或英文...",value:p,onChange:t=>S(t.target.value),className:"w-full rounded-lg border border-slate-300 pl-10 pr-4 py-2"})]}),a("div",{className:"flex items-center gap-2",children:[e(U,{size:18,className:"text-slate-400"}),a("select",{value:x,onChange:t=>z(t.target.value),className:"rounded border border-slate-300 px-3 py-2",children:[e("option",{value:"",children:"所有分类"}),O.map(t=>e("option",{value:t,children:t},t))]})]})]})}),a("div",{className:"rounded-lg bg-white p-6 shadow",children:[e("div",{className:"overflow-x-auto",children:a("table",{className:"w-full",children:[e("thead",{children:a("tr",{className:"border-b border-slate-200",children:[e("th",{className:"px-4 py-3 text-left text-sm font-semibold text-slate-700",children:"关键词"}),e("th",{className:"px-4 py-3 text-left text-sm font-semibold text-slate-700",children:"分类"}),e("th",{className:"px-4 py-3 text-left text-sm font-semibold text-slate-700",children:"中文"}),e("th",{className:"px-4 py-3 text-left text-sm font-semibold text-slate-700",children:"英文/菲律宾文"}),e("th",{className:"px-4 py-3 text-left text-sm font-semibold text-slate-700",children:"描述"}),e("th",{className:"px-4 py-3 text-left text-sm font-semibold text-slate-700",children:"操作"})]})}),e("tbody",{children:k.map(t=>a("tr",{className:"border-b border-slate-100 hover:bg-slate-50",children:[e("td",{className:"px-4 py-3 font-mono text-sm text-slate-700",children:t.key_code}),e("td",{className:"px-4 py-3",children:e("span",{className:"rounded bg-slate-100 px-2 py-1 text-xs text-slate-700",children:t.category})}),e("td",{className:"px-4 py-3",children:t.zh_cn}),e("td",{className:"px-4 py-3",children:t.en_ph}),e("td",{className:"px-4 py-3 text-sm text-slate-600",children:t.description}),e("td",{className:"px-4 py-3",children:a("div",{className:"flex gap-2",children:[e("button",{onClick:()=>T(t),className:"rounded bg-blue-100 p-1 text-blue-700 hover:bg-blue-200",children:e(Y,{size:16})}),e("button",{onClick:()=>R(t.key_code),className:"rounded bg-red-100 p-1 text-red-700 hover:bg-red-200",children:e(X,{size:16})})]})})]},t.key_code))})]})}),k.length===0&&e("div",{className:"py-8 text-center text-slate-500",children:p||x?"没有找到匹配的词库条目":"暂无词库条目"})]}),C&&e("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:a("div",{className:"w-full max-w-2xl rounded-lg bg-white p-6",children:[a("div",{className:"mb-4 flex items-center justify-between",children:[e("h3",{className:"text-xl font-bold text-slate-900",children:m?"编辑词库条目":"添加词库条目"}),e("button",{onClick:E,className:"rounded-full p-1 hover:bg-slate-100",children:e(D,{size:20})})]}),a("form",{onSubmit:P,className:"space-y-4",children:[a("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[a("div",{children:[e("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"关键词 (唯一标识)"}),e("input",{type:"text",name:"key_code",value:d.key_code,onChange:_,required:!0,disabled:!!m,className:"w-full rounded border border-slate-300 px-3 py-2 disabled:bg-slate-100",placeholder:"如: ORDER_PENDING"})]}),a("div",{children:[e("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"分类"}),a("select",{name:"category",value:d.category,onChange:_,required:!0,className:"w-full rounded border border-slate-300 px-3 py-2",children:[e("option",{value:"",children:"选择分类"}),e("option",{value:"STATUS",children:"状态"}),e("option",{value:"PAYMENT",children:"支付"}),e("option",{value:"UI",children:"界面操作"}),e("option",{value:"EXPENSE",children:"财务分类"}),e("option",{value:"OTHER",children:"其他"})]})]})]}),a("div",{children:[e("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"中文显示"}),e("input",{type:"text",name:"zh_cn",value:d.zh_cn,onChange:_,required:!0,className:"w-full rounded border border-slate-300 px-3 py-2",placeholder:"如: 待接单"})]}),a("div",{children:[e("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"英文/菲律宾文显示"}),e("input",{type:"text",name:"en_ph",value:d.en_ph,onChange:_,required:!0,className:"w-full rounded border border-slate-300 px-3 py-2",placeholder:"如: Pending / New Order"})]}),a("div",{children:[e("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"描述"}),e("textarea",{name:"description",value:d.description,onChange:_,className:"w-full rounded border border-slate-300 px-3 py-2",placeholder:"词条用途备注",rows:2})]}),a("div",{className:"flex gap-2",children:[a("button",{type:"submit",className:"flex items-center gap-2 rounded bg-blue-600 px-4 py-2 text-white hover:bg-blue-700",children:[e(F,{size:18}),"保存"]}),a("button",{type:"button",onClick:E,className:"flex items-center gap-2 rounded border border-slate-300 px-4 py-2 hover:bg-slate-50",children:[e(D,{size:18}),"取消"]})]})]})]})}),i&&e("div",{className:"rounded-lg bg-red-50 p-4 text-red-700",children:i})]})};export{K as default};
