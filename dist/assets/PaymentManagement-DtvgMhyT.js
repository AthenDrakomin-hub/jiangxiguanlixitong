import{jsx as e,jsxs as a}from"react/jsx-runtime";import{useState as n,useEffect as R}from"react";import{AlertCircle as P,Plus as S,Save as I,Edit3 as O,Trash2 as M,CreditCard as x,Coins as q,Wallet as U,Banknote as D}from"lucide-react";import{a as i}from"./index-CHj5k0ei.js";import"react-dom/client";const F=()=>{const[o,m]=n([]),[f,b]=n(!0),[g,u]=n(null),[c,h]=n(null),[N,p]=n(!1),[r,s]=n({name:"",englishName:"",isEnabled:!0,qrCodeUrl:"",accountInfo:"",paymentType:"CASH",currency:"PHP",exchangeRate:1,sortOrder:0});R(()=>{d()},[]);const d=async()=>{try{b(!0),u(null);const t=await i.fetchAll();if(t.paymentMethods&&Array.isArray(t.paymentMethods)){const l=t.paymentMethods;m(l.sort((k,T)=>k.sortOrder-T.sortOrder))}else m([])}catch(t){console.error("加载支付方式失败:",t),u("加载支付方式失败: "+(t instanceof Error?t.message:"未知错误")),m([])}finally{b(!1)}},v=async t=>{t.preventDefault();try{if(c)await i.update("payment_methods",c.id,{...r,id:c.id});else{const l={...r,id:`PM-${Date.now()}`};await i.create("payment_methods",l)}y(),await d()}catch(l){console.error("保存支付方式失败:",l),alert("保存失败: "+(l instanceof Error?l.message:"未知错误"))}},y=()=>{h(null),p(!1),s({name:"",englishName:"",isEnabled:!0,qrCodeUrl:"",accountInfo:"",paymentType:"CASH",currency:"PHP",exchangeRate:1,sortOrder:0})},w=t=>{h(t),s({name:t.name,englishName:t.englishName,isEnabled:t.isEnabled,qrCodeUrl:t.qrCodeUrl||"",accountInfo:t.accountInfo||"",paymentType:t.paymentType,currency:t.currency,exchangeRate:t.exchangeRate,sortOrder:t.sortOrder}),p(!0)},C=async t=>{if(window.confirm("确定要删除这个支付方式吗？此操作无法撤销。"))try{await i.remove("payment_methods",t),await d()}catch(l){console.error("删除支付方式失败:",l),alert("删除失败: "+(l instanceof Error?l.message:"未知错误"))}},A=t=>{switch(t){case"CASH":return e(D,{size:16});case"MOBILE_WALLET":return e(U,{size:16});case"CRYPTO":return e(q,{size:16});case"BANK_TRANSFER":return e(x,{size:16});default:return e(x,{size:16})}},E=t=>{switch(t){case"CASH":return"现金";case"MOBILE_WALLET":return"移动钱包";case"CRYPTO":return"加密货币";case"BANK_TRANSFER":return"银行转账";case"CREDIT_CARD":return"信用卡";default:return t}};return f?e("div",{className:"flex h-64 items-center justify-center",children:e("div",{className:"h-8 w-8 animate-spin rounded-full border-b-2 border-slate-900"})}):a("div",{className:"space-y-6",children:[g&&e("div",{className:"rounded-lg border-l-4 border-red-500 bg-red-50 p-4",children:a("div",{className:"flex items-start",children:[e(P,{className:"mt-0.5 h-5 w-5 text-red-500"}),a("div",{className:"ml-3",children:[e("h3",{className:"text-sm font-medium text-red-800",children:"加载失败"}),e("p",{className:"mt-1 text-sm text-red-700",children:g}),e("button",{onClick:d,className:"mt-2 text-sm font-medium text-red-800 underline hover:text-red-900",children:"重试"})]})]})}),a("div",{className:"flex items-center justify-between",children:[a("div",{children:[e("h2",{className:"text-2xl font-bold text-slate-800",children:"支付方式管理"}),e("p",{className:"mt-1 text-sm text-slate-500",children:"配置和管理所有支付方式"})]}),a("button",{onClick:()=>{h(null),p(!0),s({name:"",englishName:"",isEnabled:!0,qrCodeUrl:"",accountInfo:"",paymentType:"CASH",currency:"PHP",exchangeRate:1,sortOrder:o.length}),u(null)},className:"flex items-center gap-2 rounded-lg bg-slate-900 px-4 py-2 text-white hover:bg-slate-800",children:[e(S,{size:16}),"添加支付方式"]})]}),N&&a("div",{className:"rounded-xl border border-slate-100 bg-white p-6 shadow-sm",children:[e("h3",{className:"mb-4 text-lg font-bold text-slate-800",children:c?"编辑支付方式":"添加新支付方式"}),a("form",{onSubmit:v,className:"space-y-4",children:[a("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[a("div",{children:[e("label",{className:"mb-1 block text-sm font-medium text-slate-700",children:"支付方式名称 *"}),e("input",{type:"text",value:r.name,onChange:t=>s({...r,name:t.target.value}),className:"w-full rounded-lg border border-slate-300 px-3 py-2",required:!0})]}),a("div",{children:[e("label",{className:"mb-1 block text-sm font-medium text-slate-700",children:"英文名称"}),e("input",{type:"text",value:r.englishName,onChange:t=>s({...r,englishName:t.target.value}),className:"w-full rounded-lg border border-slate-300 px-3 py-2"})]}),a("div",{children:[e("label",{className:"mb-1 block text-sm font-medium text-slate-700",children:"支付类型 *"}),a("select",{value:r.paymentType,onChange:t=>s({...r,paymentType:t.target.value}),className:"w-full rounded-lg border border-slate-300 px-3 py-2",required:!0,children:[e("option",{value:"CASH",children:"现金 (Cash)"}),e("option",{value:"WECHAT",children:"微信支付 (WeChat Pay)"}),e("option",{value:"ALIPAY",children:"支付宝 (Alipay)"}),e("option",{value:"USDT",children:"USDT (加密货币)"}),e("option",{value:"GCASH",children:"GCash (菲律宾)"}),e("option",{value:"MAYA",children:"Maya (菲律宾)"}),e("option",{value:"UNIONPAY",children:"银联 (UnionPay)"}),e("option",{value:"CREDIT_CARD",children:"信用卡 (Credit Card)"}),e("option",{value:"SIGN_BILL",children:"挂账 (Sign Bill)"})]})]}),a("div",{children:[e("label",{className:"mb-1 block text-sm font-medium text-slate-700",children:"货币"}),e("input",{type:"text",value:r.currency,onChange:t=>s({...r,currency:t.target.value}),className:"w-full rounded-lg border border-slate-300 px-3 py-2",required:!0})]}),a("div",{children:[e("label",{className:"mb-1 block text-sm font-medium text-slate-700",children:"汇率"}),e("input",{type:"number",step:"0.01",value:r.exchangeRate,onChange:t=>s({...r,exchangeRate:parseFloat(t.target.value)||0}),className:"w-full rounded-lg border border-slate-300 px-3 py-2",required:!0})]}),a("div",{children:[e("label",{className:"mb-1 block text-sm font-medium text-slate-700",children:"排序"}),e("input",{type:"number",value:r.sortOrder,onChange:t=>s({...r,sortOrder:parseInt(t.target.value)||0}),className:"w-full rounded-lg border border-slate-300 px-3 py-2",required:!0})]}),a("div",{children:[e("label",{className:"mb-1 block text-sm font-medium text-slate-700",children:"QR码URL"}),e("input",{type:"text",value:r.qrCodeUrl||"",onChange:t=>s({...r,qrCodeUrl:t.target.value}),className:"w-full rounded-lg border border-slate-300 px-3 py-2"})]}),a("div",{children:[e("label",{className:"mb-1 block text-sm font-medium text-slate-700",children:"账户信息"}),e("input",{type:"text",value:r.accountInfo||"",onChange:t=>s({...r,accountInfo:t.target.value}),className:"w-full rounded-lg border border-slate-300 px-3 py-2"})]}),a("div",{className:"flex items-center",children:[e("input",{type:"checkbox",checked:r.isEnabled,onChange:t=>s({...r,isEnabled:t.target.checked}),className:"h-4 w-4 rounded border-slate-300 text-slate-900 focus:ring-slate-900"}),e("label",{className:"ml-2 block text-sm text-slate-700",children:"启用此支付方式"})]})]}),a("div",{className:"flex justify-end space-x-3",children:[e("button",{type:"button",onClick:y,className:"rounded-lg border border-slate-300 px-4 py-2 text-slate-700 hover:bg-slate-50",children:"取消"}),a("button",{type:"submit",className:"flex items-center gap-2 rounded-lg bg-slate-900 px-4 py-2 text-white hover:bg-slate-800",children:[e(I,{size:16}),"保存"]})]})]})]}),o.length>0?e("div",{className:"rounded-xl border border-slate-100 bg-white shadow-sm",children:e("div",{className:"overflow-hidden rounded-lg",children:a("table",{className:"min-w-full divide-y divide-slate-200",children:[e("thead",{className:"bg-slate-50",children:a("tr",{children:[e("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-slate-500",children:"支付方式"}),e("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-slate-500",children:"类型"}),e("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-slate-500",children:"货币/汇率"}),e("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-slate-500",children:"状态"}),e("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-slate-500",children:"操作"})]})}),e("tbody",{className:"divide-y divide-slate-200 bg-white",children:o.sort((t,l)=>t.sortOrder-l.sortOrder).map(t=>a("tr",{className:"hover:bg-slate-50",children:[e("td",{className:"whitespace-nowrap px-6 py-4",children:a("div",{className:"flex items-center",children:[e("div",{className:"flex-shrink-0",children:A(t.paymentType)}),a("div",{className:"ml-4",children:[e("div",{className:"text-sm font-medium text-slate-900",children:t.name}),t.englishName&&e("div",{className:"text-sm text-slate-500",children:t.englishName})]})]})}),e("td",{className:"whitespace-nowrap px-6 py-4 text-sm text-slate-500",children:E(t.paymentType)}),a("td",{className:"whitespace-nowrap px-6 py-4 text-sm text-slate-500",children:[t.currency," (",t.exchangeRate,")"]}),e("td",{className:"whitespace-nowrap px-6 py-4 text-sm text-slate-500",children:t.isEnabled?e("span",{className:"inline-flex rounded-full bg-green-100 px-2 text-xs font-semibold leading-5 text-green-800",children:"启用"}):e("span",{className:"inline-flex rounded-full bg-red-100 px-2 text-xs font-semibold leading-5 text-red-800",children:"禁用"})}),a("td",{className:"whitespace-nowrap px-6 py-4 text-right text-sm font-medium",children:[e("button",{onClick:()=>w(t),className:"mr-3 text-slate-600 hover:text-slate-900",children:e(O,{size:16})}),e("button",{onClick:()=>C(t.id),className:"text-red-600 hover:text-red-900",children:e(M,{size:16})})]})]},t.id))})]})})}):a("div",{className:"rounded-xl border border-slate-100 bg-white p-8 text-center shadow-sm",children:[e(x,{className:"mx-auto h-12 w-12 text-slate-400"}),e("h3",{className:"mt-2 text-sm font-medium text-slate-900",children:"暂无支付方式"}),e("p",{className:"mt-1 text-sm text-slate-500",children:'点击"添加支付方式"按钮创建新的支付方式。'})]})]})};export{F as default};
