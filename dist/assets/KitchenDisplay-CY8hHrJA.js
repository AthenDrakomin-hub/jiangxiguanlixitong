import{jsxs as e,jsx as t}from"react/jsx-runtime";import{useState as p,useEffect as v}from"react";import{X as w,ChefHat as g,LogOut as y,Clock as C,AlertTriangle as T,CheckCircle2 as O}from"lucide-react";import{O as r,a as D}from"./index-CHj5k0ei.js";import{a as S}from"./auditLogger-DYWE_lBP.js";import"react-dom/client";const N=({order:a,nextStatus:c,buttonText:m,colorClass:h,onStatusChange:x})=>{const i=s=>`${Math.floor((new Date().getTime()-new Date(s).getTime())/6e4)} min`;return e("div",{className:"animate-fade-in flex h-full flex-col overflow-hidden rounded-xl border-l-4 border-l-transparent bg-white shadow-md",style:{borderLeftColor:h},children:[e("div",{className:"flex items-center justify-between border-b border-slate-100 bg-slate-50 p-4",children:[e("div",{children:[e("span",{className:"text-2xl font-bold text-slate-800",children:["#",a.tableNumber]}),e("span",{className:"block text-xs text-slate-500",children:["ID: ",a.id.slice(-4)]})]}),e("div",{className:"text-right",children:[t("div",{className:`font-mono font-bold ${i(a.createdAt).includes("min")&&parseInt(i(a.createdAt))>15?"animate-pulse text-red-600":"text-slate-600"}`,children:i(a.createdAt)}),t("div",{className:"text-xs text-slate-400",children:new Date(a.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]}),e("div",{className:"flex-1 overflow-y-auto p-4",children:[a.items.map((s,d)=>e("div",{className:"flex items-center justify-between border-b border-dashed border-slate-200 py-2 last:border-0",children:[t("span",{className:"text-lg font-bold text-slate-800",children:s.dishName}),e("span",{className:"rounded bg-slate-100 px-3 py-1 text-xl font-bold text-slate-700",children:["x",s.quantity]})]},d)),a.notes&&e("div",{className:"mt-3 flex items-start gap-2 rounded border border-yellow-100 bg-yellow-50 p-3 font-bold text-yellow-800",children:[t(T,{size:20,className:"mt-0.5 shrink-0"}),a.notes]})]}),t("div",{className:"border-t border-slate-100 p-4",children:e("button",{onClick:()=>x(a.id,c),className:`flex w-full items-center justify-center gap-2 rounded-lg py-4 text-lg font-bold text-white transition-transform active:scale-95 ${c===r.COOKING?"bg-blue-600 hover:bg-blue-700":"bg-emerald-600 hover:bg-emerald-700"}`,children:[m," ",c===r.COOKING?t(g,{size:24}):t(O,{size:24})]})})]})},z=({orders:a,onStatusChange:c,onBack:m})=>{const[h,x]=p(new Date),[i,s]=p(null);v(()=>{const l=setInterval(()=>x(new Date),1e3);return()=>clearInterval(l)},[]);const d=async(l,n)=>{try{await D.update("orders",l,{status:n});const o=a.find(u=>u.id===l);if(o){const u=n===r.COOKING?"开始烹饪":"完成上菜";S.log("info","KITCHEN_STATUS",`厨房: ${u} - #${o.tableNumber}`,"kitchen")}c(l,n),s(null)}catch(o){s("状态更新失败: "+(o instanceof Error?o.message:"未知错误"))}},f=a.filter(l=>l.status===r.PENDING).sort((l,n)=>new Date(l.createdAt).getTime()-new Date(n.createdAt).getTime()),b=a.filter(l=>l.status===r.COOKING).sort((l,n)=>new Date(l.createdAt).getTime()-new Date(n.createdAt).getTime());return e("div",{className:"flex h-[calc(100vh-2rem)] flex-col",children:[i&&t("div",{className:"mb-4 rounded-lg border border-red-300 bg-red-100 p-4 text-red-800",children:e("div",{className:"flex items-center gap-2",children:[t(w,{size:18}),t("span",{className:"font-medium",children:i})]})}),e("div",{className:"mb-6 flex items-center justify-between",children:[e("h2",{className:"flex items-center gap-3 text-3xl font-bold text-white",children:[t(g,{size:32})," Kitchen Display (KDS)"]}),e("div",{className:"flex items-center gap-4",children:[t("div",{className:"font-mono text-xl text-white/80",children:h.toLocaleTimeString()}),e("button",{onClick:m,className:"flex items-center gap-2 rounded-lg border border-white/20 bg-white/10 px-4 py-2 text-white transition-colors hover:bg-white/20",children:[t(y,{size:18}),t("span",{children:"Exit / Lumabas"})]})]})]}),e("div",{className:"grid flex-1 grid-cols-2 gap-6 overflow-hidden",children:[e("div",{className:"flex flex-col rounded-2xl border border-slate-700/50 bg-slate-800/50 p-4",children:[e("div",{className:"mb-4 flex items-center justify-between px-2",children:[e("h3",{className:"flex items-center gap-2 text-xl font-bold text-white",children:[t("span",{className:"h-3 w-3 animate-pulse rounded-full bg-orange-500"})," ","Pending / Naghihintay"]}),t("span",{className:"rounded-full bg-slate-700 px-3 py-1 text-sm font-bold text-white",children:f.length})]}),e("div",{className:"flex-1 space-y-4 overflow-y-auto pr-2",children:[f.map(l=>t(N,{order:l,nextStatus:r.COOKING,buttonText:"Start Cooking / Simulan",colorClass:"#f97316",onStatusChange:d},l.id)),f.length===0&&e("div",{className:"flex h-full flex-col items-center justify-center text-slate-500 opacity-50",children:[t(C,{size:64}),t("p",{className:"mt-4 text-xl",children:"No pending orders / Walang order"})]})]})]}),e("div",{className:"flex flex-col rounded-2xl border border-slate-700/50 bg-slate-800/50 p-4",children:[e("div",{className:"mb-4 flex items-center justify-between px-2",children:[e("h3",{className:"flex items-center gap-2 text-xl font-bold text-white",children:[t("span",{className:"h-3 w-3 rounded-full bg-blue-500"})," Cooking / Nagluluto"]}),t("span",{className:"rounded-full bg-slate-700 px-3 py-1 text-sm font-bold text-white",children:b.length})]}),e("div",{className:"flex-1 space-y-4 overflow-y-auto pr-2",children:[b.map(l=>t(N,{order:l,nextStatus:r.SERVED,buttonText:"Serve / I-serve",colorClass:"#3b82f6",onStatusChange:d},l.id)),b.length===0&&e("div",{className:"flex h-full flex-col items-center justify-center text-slate-500 opacity-50",children:[t(g,{size:64}),t("p",{className:"mt-4 text-xl",children:"Kitchen Idle"})]})]})]})]})]})};export{z as default};
