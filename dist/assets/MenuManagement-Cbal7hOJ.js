import{j as e,g as le}from"./index-BV8Zipq2.js";import{r as c}from"./react-vendor-C14am9Lm.js";import{u as re,a as F,D as ne,c as ie,S as oe,r as de,b as ce,s as xe,K as me,P as ue,d as ge,C as he}from"./dnd-kit-BmW_o0eU.js";import{l as T,m as pe,n as H,o as be,p as fe,q as je,r as ve,s as Q,k as Ne,t as K,X as G,I as we,u as _,G as ye,v as Se}from"./lucide-CwzgdtcU.js";import"./aws-sdk-BT5ufFbJ.js";import"./recharts-wRm9IGXD.js";const ke=({dish:r,isSelected:x,toggleSelection:p,handleOpenModal:b,handleDelete:w,isDragEnabled:S})=>{const{attributes:f,listeners:z,setNodeRef:I,transform:j,transition:y,isDragging:v}=ge({id:r.id,disabled:!S}),l={transform:he.Transform.toString(j),transition:y,zIndex:v?50:"auto",opacity:v?.5:1};return e.jsxs("div",{ref:I,style:l,...f,className:`bg-white rounded-xl shadow-sm border overflow-hidden group hover:shadow-md transition-all duration-200 relative ${x?"ring-2 ring-red-500 border-red-500":"border-slate-100"} ${v?"shadow-xl scale-105":""}`,children:[e.jsxs("div",{className:"relative h-48 overflow-hidden bg-slate-100",children:[e.jsx("img",{src:r.imageUrl,alt:r.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300",loading:"lazy"}),e.jsx("div",{className:"absolute top-2 left-2 z-10 p-1 cursor-pointer",onClick:d=>{d.stopPropagation(),p(r.id)},children:e.jsx("div",{className:`w-6 h-6 rounded-lg border-2 flex items-center justify-center shadow-sm transition-all ${x?"bg-red-600 border-red-600 text-white scale-110":"bg-white/90 border-slate-300 text-transparent hover:border-red-400"}`,children:e.jsx(H,{size:14,strokeWidth:3})})}),S&&e.jsx("div",{...z,className:"absolute top-2 left-1/2 -translate-x-1/2 z-10 p-1 cursor-grab active:cursor-grabbing opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("div",{className:"bg-black/30 backdrop-blur-sm text-white p-1.5 rounded-full hover:bg-black/50",children:e.jsx(ye,{size:16})})}),!r.available&&e.jsx("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center pointer-events-none",children:e.jsx("span",{className:"text-white font-bold px-3 py-1 bg-red-600 rounded-full text-sm shadow-lg",children:"Sold Out / Ubos Na"})}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity z-10",children:[e.jsx("button",{onClick:d=>{d.stopPropagation(),b(r)},className:"p-2 bg-white rounded-full shadow-lg hover:bg-slate-100 text-slate-600 transition-colors",children:e.jsx(Se,{size:16})}),e.jsx("button",{onClick:d=>{d.stopPropagation(),w(r.id)},className:"p-2 bg-white rounded-full shadow-lg hover:bg-red-50 text-red-500 transition-colors",children:e.jsx(Q,{size:16})})]})]}),e.jsxs("div",{className:"p-4",onClick:()=>p(r.id),children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"font-bold text-slate-800 line-clamp-1",children:r.name}),e.jsxs("span",{className:"font-bold text-red-600",children:["₱",r.price]})]}),e.jsx("p",{className:"text-sm text-slate-500 line-clamp-2 mb-3 h-10",children:r.description}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-400",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-2 py-1 bg-slate-100 rounded text-slate-600",children:r.category}),r.ingredients&&r.ingredients.length>0&&e.jsx("span",{className:"flex items-center gap-1 text-emerald-600",title:"BOM Active",children:e.jsx(_,{size:12})})]}),e.jsx("div",{className:"flex gap-1",children:Array.from({length:3}).map((d,g)=>e.jsx("div",{className:`w-2 h-2 rounded-full ${g<r.spiciness?"bg-red-500":"bg-slate-200"}`},g))})]})]})]})},Ae=({dishes:r,setDishes:x,inventory:p,categories:b})=>{const[w,S]=c.useState(""),[f,z]=c.useState("All"),[I,j]=c.useState(!1),[y,v]=c.useState(null),[l,d]=c.useState(new Set),[g,U]=c.useState(!1),[M,D]=c.useState(!1),[n,i]=c.useState({name:"",description:"",price:0,category:b[0]||"热菜",imageUrl:"",spiciness:0,available:!0,ingredients:[]}),[k,A]=c.useState(""),[C,P]=c.useState(""),V=re(F(ue,{activationConstraint:{distance:8}}),F(me,{coordinateGetter:xe})),m=r.filter(s=>{const t=s.name.toLowerCase().includes(w.toLowerCase()),a=f==="All"||s.category===f;return t&&a}),$=w===""&&f==="All",W=s=>{const t=new Set(l);t.has(s)?t.delete(s):t.add(s),d(t)},X=()=>{l.size===m.length&&m.length>0?d(new Set):d(new Set(m.map(s=>s.id)))},E=s=>{if(l.size!==0){if(s==="delete"){if(!confirm(`Delete ${l.size} dishes? 确定要删除选中的菜品吗？`))return;x(t=>t.filter(a=>!l.has(a.id)))}else s==="enable"?x(t=>t.map(a=>l.has(a.id)?{...a,available:!0}:a)):s==="disable"&&x(t=>t.map(a=>l.has(a.id)?{...a,available:!1}:a));d(new Set),U(!1)}},J=s=>{const{active:t,over:a}=s;a&&t.id!==a.id&&x(u=>{const o=u.findIndex(h=>h.id===t.id),N=u.findIndex(h=>h.id===a.id);return ce(u,o,N)})},L=s=>{s?(v(s),i(s)):(v(null),i({name:"",description:"",price:0,category:b[0]||"热菜",imageUrl:`https://picsum.photos/400/300?random=${Math.floor(Math.random()*1e3)}`,spiciness:0,available:!0,ingredients:[]})),A(""),P(""),j(!0)},Y=s=>{if(confirm("Delete this dish? 确定要删除这道菜吗？")&&(x(t=>t.filter(a=>a.id!==s)),l.has(s))){const t=new Set(l);t.delete(s),d(t)}},B=s=>{if(s.preventDefault(),y)x(t=>t.map(a=>a.id===y.id?{...a,...n}:a));else{const t={...n,id:Math.random().toString(36).substr(2,9)};x(a=>[...a,t])}j(!1)},Z=()=>{if(!k||!C)return;const s=parseFloat(C);if(isNaN(s)||s<=0)return;const t={ingredientId:k,quantity:s};i(a=>({...a,ingredients:[...a.ingredients||[],t]})),A(""),P("")},ee=s=>{i(t=>{var a;return{...t,ingredients:(a=t.ingredients)==null?void 0:a.filter((u,o)=>o!==s)}})},R=async s=>{var u;const t=(u=s.target.files)==null?void 0:u[0];if(!t)return;if(t.size>5*1024*1024){alert("Image too large. Max 5MB. 图片太大");return}D(!0);try{const o=le(),N=t.name.split(".").pop(),O=`${`${Math.random().toString(36).substring(2,15)}.${N}`}`,{data:se,error:q}=await o.storage.from("dish-images").upload(O,t);if(!q&&se){const{data:{publicUrl:te}}=o.storage.from("dish-images").getPublicUrl(O);i(ae=>({...ae,imageUrl:te})),D(!1);return}else console.warn("Supabase upload failed (Bucket might not exist), falling back to Base64:",q)}catch(o){console.warn("Upload error:",o)}const a=new FileReader;a.onloadend=()=>{i(o=>({...o,imageUrl:a.result})),D(!1)},a.readAsDataURL(t)};return c.useEffect(()=>{const s=t=>{g&&!t.target.closest(".bulk-menu-container")&&U(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[g]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Menu Management 菜单管理"}),e.jsx("p",{className:"text-slate-500 text-sm",children:"Pamamahala ng Menu"})]}),e.jsxs("button",{onClick:()=>L(),className:"flex items-center gap-2 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors shadow-lg shadow-red-200",children:[e.jsx(T,{size:20}),e.jsx("span",{children:"Add Dish / Magdagdag"})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-slate-100 flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(pe,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:20}),e.jsx("input",{type:"text",placeholder:"Search / 搜索 / Hanapin...",value:w,onChange:s=>S(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent"})]}),e.jsxs("select",{value:f,onChange:s=>z(s.target.value),className:"px-4 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 bg-white",children:[e.jsx("option",{value:"All",children:"All Categories / Lahat"}),b.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"flex items-center justify-between bg-white px-4 py-3 rounded-lg border border-slate-100 shadow-sm animate-fade-in",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer text-sm font-medium text-slate-600 hover:text-slate-800 select-none",children:[e.jsx("div",{className:`w-5 h-5 rounded border flex items-center justify-center transition-colors ${m.length>0&&l.size===m.length?"bg-red-600 border-red-600 text-white":"bg-white border-slate-300"}`,onClick:s=>{s.preventDefault(),X()},children:m.length>0&&l.size===m.length&&e.jsx(H,{size:14})}),"Select All / Piliin Lahat (",l.size,")"]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[!$&&e.jsx("span",{className:"text-xs text-orange-500 bg-orange-50 px-2 py-1 rounded",children:"* Clear filters to sort"}),e.jsxs("div",{className:"relative bulk-menu-container",children:[e.jsxs("button",{onClick:()=>U(!g),disabled:l.size===0,className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium border transition-all ${l.size>0?"bg-white border-slate-300 text-slate-700 hover:bg-slate-50 hover:border-slate-400 shadow-sm":"bg-slate-50 border-slate-200 text-slate-400 cursor-not-allowed"}`,children:[e.jsx(be,{size:16}),e.jsx("span",{children:"Batch / Maramihan"}),e.jsx(fe,{size:14,className:`transition-transform ${g?"rotate-180":""}`})]}),g&&l.size>0&&e.jsxs("div",{className:"absolute right-0 top-full mt-2 w-48 bg-white rounded-xl shadow-xl border border-slate-100 py-2 z-20 animate-in fade-in slide-in-from-top-2",children:[e.jsxs("div",{className:"px-4 py-2 text-xs font-semibold text-slate-400 uppercase tracking-wider border-b border-slate-50 mb-1",children:["Selected ",l.size]}),e.jsxs("button",{onClick:()=>E("enable"),className:"w-full text-left px-4 py-2.5 text-sm text-slate-700 hover:bg-green-50 hover:text-green-700 flex items-center gap-2 transition-colors",children:[e.jsx(je,{size:16}),"Enable / Paganahin"]}),e.jsxs("button",{onClick:()=>E("disable"),className:"w-full text-left px-4 py-2.5 text-sm text-slate-700 hover:bg-orange-50 hover:text-orange-700 flex items-center gap-2 transition-colors",children:[e.jsx(ve,{size:16}),"Disable / Huwag Paganahin"]}),e.jsx("div",{className:"h-px bg-slate-100 my-1"}),e.jsxs("button",{onClick:()=>E("delete"),className:"w-full text-left px-4 py-2.5 text-sm text-red-600 hover:bg-red-50 hover:text-red-700 flex items-center gap-2 transition-colors",children:[e.jsx(Q,{size:16}),"Delete / Tanggalin"]})]})]})]})]}),e.jsx(ne,{sensors:V,collisionDetection:ie,onDragEnd:J,children:e.jsx(oe,{items:m.map(s=>s.id),strategy:de,children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:m.map(s=>e.jsx(ke,{dish:s,isSelected:l.has(s.id),toggleSelection:W,handleOpenModal:L,handleDelete:Y,isDragEnabled:$},s.id))})})}),I&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 flex justify-between items-center shrink-0",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-800",children:y?"Edit Dish / I-edit":"Add Dish / Magdagdag"}),e.jsx("button",{onClick:()=>j(!1),className:"text-slate-400 hover:text-slate-600",children:"×"})]}),e.jsx("form",{onSubmit:B,className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Name / Pangalan"}),e.jsx("div",{className:"flex gap-2",children:e.jsx("input",{type:"text",required:!0,value:n.name,onChange:s=>i(t=>({...t,name:s.target.value})),className:"flex-1 px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500",placeholder:"e.g. Spicy Tofu"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Price / Presyo (₱)"}),e.jsx("input",{type:"number",required:!0,min:"0",value:n.price,onChange:s=>i(t=>({...t,price:Number(s.target.value)})),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Category / Kategorya"}),e.jsx("select",{value:n.category,onChange:s=>i(t=>({...t,category:s.target.value})),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 bg-white",children:b.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Spiciness / Anghang (0-3)"}),e.jsx("input",{type:"range",min:"0",max:"3",value:n.spiciness,onChange:s=>i(t=>({...t,spiciness:Number(s.target.value)})),className:"w-full accent-red-600"}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-400 mt-1",children:[e.jsx("span",{children:"None"}),e.jsx("span",{children:"Mild"}),e.jsx("span",{children:"Medium"}),e.jsx("span",{children:"Hot"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"available",checked:n.available,onChange:s=>i(t=>({...t,available:s.target.checked})),className:"w-4 h-4 text-red-600 rounded focus:ring-red-500"}),e.jsx("label",{htmlFor:"available",className:"text-sm font-medium text-slate-700",children:"Available / Magagamit"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Description / Paglalarawan"}),e.jsx("textarea",{rows:4,value:n.description,onChange:s=>i(t=>({...t,description:s.target.value})),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 resize-none"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Image / Larawan"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"aspect-video rounded-xl border-2 border-dashed border-slate-200 bg-slate-50 flex items-center justify-center overflow-hidden relative group transition-colors hover:border-red-200",children:M?e.jsxs("div",{className:"flex flex-col items-center gap-2 text-slate-400",children:[e.jsx(Ne,{className:"animate-spin",size:24}),e.jsx("span",{className:"text-xs",children:"Uploading to 'dish-images'..."})]}):n.imageUrl?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:n.imageUrl,alt:"Preview",className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2",children:[e.jsxs("label",{className:"cursor-pointer p-2 bg-white/20 hover:bg-white/40 rounded-full text-white backdrop-blur-sm transition-colors",title:"Change",children:[e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:R}),e.jsx(K,{size:20})]}),e.jsx("button",{type:"button",onClick:()=>i(s=>({...s,imageUrl:""})),className:"p-2 bg-white/20 hover:bg-red-600/80 rounded-full text-white backdrop-blur-sm transition-colors",title:"Remove",children:e.jsx(G,{size:20})})]})]}):e.jsxs("label",{className:"cursor-pointer w-full h-full flex flex-col items-center justify-center text-slate-400 hover:text-red-500 hover:bg-red-50/30 transition-all",children:[e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:R}),e.jsx("div",{className:"p-3 bg-white rounded-full shadow-sm mb-3",children:e.jsx(K,{size:24})}),e.jsx("span",{className:"text-sm font-medium",children:"Click to Upload 上传图片"})]})}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(we,{size:16,className:"text-slate-400"})}),e.jsx("input",{type:"text",placeholder:"Or enter Image URL... 或输入图片链接",value:n.imageUrl,onChange:s=>i(t=>({...t,imageUrl:s.target.value})),className:"w-full pl-10 pr-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 text-sm bg-slate-50 focus:bg-white transition-colors"})]})]})]}),e.jsxs("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-200",children:[e.jsxs("h4",{className:"text-sm font-bold text-slate-800 mb-3 flex items-center gap-2",children:[e.jsx(_,{size:16})," Recipe / Resipe"]}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsxs("select",{value:k,onChange:s=>A(s.target.value),className:"flex-1 text-sm border border-slate-200 rounded-lg px-2 py-1.5",children:[e.jsx("option",{value:"",children:"Select Ingredient 选择食材..."}),p.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.unit,")"]},s.id))]}),e.jsx("input",{type:"number",placeholder:"Qty 数量",className:"w-20 text-sm border border-slate-200 rounded-lg px-2 py-1.5",value:C,onChange:s=>P(s.target.value)}),e.jsx("button",{type:"button",onClick:Z,disabled:!k||!C,className:"bg-slate-900 text-white p-1.5 rounded-lg disabled:opacity-50",children:e.jsx(T,{size:16})})]}),e.jsxs("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:[n.ingredients&&n.ingredients.map((s,t)=>{var o,N;const a=((o=p.find(h=>h.id===s.ingredientId))==null?void 0:o.name)||"Unknown",u=((N=p.find(h=>h.id===s.ingredientId))==null?void 0:N.unit)||"";return e.jsxs("div",{className:"flex justify-between items-center text-sm bg-white p-2 rounded border border-slate-200",children:[e.jsx("span",{children:a}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-mono",children:[s.quantity," ",u]}),e.jsx("button",{type:"button",onClick:()=>ee(t),className:"text-slate-400 hover:text-red-500",children:e.jsx(G,{size:14})})]})]},t)}),(!n.ingredients||n.ingredients.length===0)&&e.jsx("div",{className:"text-center text-slate-400 text-xs py-2",children:"No ingredients bound. 暂无配方"})]}),e.jsx("p",{className:"text-xs text-slate-400 mt-2",children:"Stock deducted automatically. Awtomatikong ibabawas ang stock."})]})]})]})}),e.jsxs("div",{className:"p-6 border-t border-slate-100 bg-white flex justify-end gap-3 shrink-0",children:[e.jsx("button",{type:"button",onClick:()=>j(!1),className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:"Cancel / Kanselahin"}),e.jsx("button",{type:"button",onClick:B,disabled:M,className:"px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium shadow-sm shadow-red-200 disabled:opacity-50",children:M?"Uploading...":"Save / I-save"})]})]})})]})};export{Ae as default};
