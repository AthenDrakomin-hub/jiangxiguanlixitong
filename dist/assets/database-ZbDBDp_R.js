class c{store=new Map;async connect(){console.log("Memory database connected")}async disconnect(){console.log("Memory database disconnected")}async get(r){return this.store.get(r)||null}async set(r,t){this.validateData(r,t),this.store.set(r,t)}async delete(r){return this.store.delete(r)}async getAll(r){const t=[];for(const[e,i]of this.store.entries())e.startsWith(r)&&t.push(i);return t}async create(r,t){const e=this.generateId(),i=new Date().toISOString(),n={...t,id:e,createdAt:i,updatedAt:i};return this.validateData(`${r}:${e}`,n),await this.set(`${r}:${e}`,n),n}async update(r,t,e){const i=`${r}:${t}`,n=await this.get(i);if(!n)return null;const o={...n,...e,updatedAt:new Date().toISOString()};return this.validateData(i,o),await this.set(i,o),o}async remove(r,t){const e=`${r}:${t}`;return await this.delete(e)}generateId(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}validateData(r,t){switch(r.split(":")[0]){case"orders":if(t.total===void 0||t.total===null)throw new Error("订单逻辑错误：总额(total)不能为空");if(t.items===void 0||!Array.isArray(t.items))throw new Error("订单逻辑错误：订单项(items)必须为数组");if(t.tableId===void 0||t.tableId==="")throw new Error("订单逻辑错误：桌号(tableId)不能为空");break;case"dishes":if(t.name===void 0||t.name==="")throw new Error("菜品逻辑错误：菜品名称(name)不能为空");if(typeof t.price!="number"||t.price<0)throw new Error("菜品逻辑错误：菜品价格(price)必须为非负数");break;case"expenses":if(t.amount===void 0||typeof t.amount!="number"||t.amount<=0)throw new Error("支出逻辑错误：支出金额(amount)必须为正数");if(t.category===void 0||t.category==="")throw new Error("支出逻辑错误：支出类别(category)不能为空");if(t.description===void 0||t.description==="")throw new Error("支出逻辑错误：支出描述(description)不能为空");break;case"inventory":if(t.name===void 0||t.name==="")throw new Error("库存逻辑错误：库存名称(name)不能为空");if(typeof t.quantity!="number"||t.quantity<0)throw new Error("库存逻辑错误：库存数量(quantity)必须为非负数");if(t.unit===void 0||t.unit==="")throw new Error("库存逻辑错误：库存单位(unit)不能为空");break;case"hotel_rooms":if(t.roomNumber===void 0||t.roomNumber==="")throw new Error("酒店房间逻辑错误：房间号(roomNumber)不能为空");if(t.status===void 0||!["available","occupied","maintenance","cleaning"].includes(t.status))throw new Error("酒店房间逻辑错误：房间状态(status)必须为有效值");break;case"sign_bill_accounts":if(t.accountName===void 0||t.accountName==="")throw new Error("签单账户逻辑错误：账户名称(accountName)不能为空");if(typeof t.creditLimit!="number"||t.creditLimit<0)throw new Error("签单账户逻辑错误：信用额度(creditLimit)必须为非负数");break;case"partner_accounts":if(t.name_cn===void 0||t.name_cn==="")throw new Error("合作伙伴账户逻辑错误：单位中文名(name_cn)不能为空");if(t.name_en===void 0||t.name_en==="")throw new Error("合作伙伴账户逻辑错误：单位英文名(name_en)不能为空");if(t.contact_person===void 0||t.contact_person==="")throw new Error("合作伙伴账户逻辑错误：联系人(contact_person)不能为空");if(t.phone===void 0||t.phone==="")throw new Error("合作伙伴账户逻辑错误：联系电话(phone)不能为空");if(typeof t.credit_limit!="number"||t.credit_limit<0)throw new Error("合作伙伴账户逻辑错误：信用额度(credit_limit)必须为非负数");if(typeof t.current_balance!="number"||t.current_balance<0)throw new Error("合作伙伴账户逻辑错误：当前余额(current_balance)必须为非负数");break}}}class d{store=new Map;initialized=!1;async connect(){this.initialized=!0}async disconnect(){this.initialized=!1}async get(r){return this.initialized||await this.connect(),this.store.get(r)||null}async set(r,t){this.initialized||await this.connect(),this.validateData(r,t),this.store.set(r,t)}async delete(r){return this.initialized||await this.connect(),this.store.delete(r)}async getAll(r){this.initialized||await this.connect();const t=[];for(const[e,i]of this.store.entries())e.startsWith(r)&&t.push(i);return t}async create(r,t){this.initialized||await this.connect();const e=this.generateId(),i=new Date().toISOString(),n={...t,id:e,createdAt:i,updatedAt:i};return this.validateData(`${r}:${e}`,n),await this.set(`${r}:${e}`,n),n}async update(r,t,e){this.initialized||await this.connect();const i=`${r}:${t}`,n=await this.get(i);if(!n)return null;const o={...n,...e,updatedAt:new Date().toISOString()};return this.validateData(i,o),await this.set(i,o),o}async remove(r,t){this.initialized||await this.connect();const e=`${r}:${t}`;return await this.delete(e)}generateId(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}validateData(r,t){switch(r.split(":")[0]){case"orders":if(t.total===void 0||t.total===null)throw new Error("订单逻辑错误：总额(total)不能为空");if(t.items===void 0||!Array.isArray(t.items))throw new Error("订单逻辑错误：订单项(items)必须为数组");if(t.tableId===void 0||t.tableId==="")throw new Error("订单逻辑错误：桌号(tableId)不能为空");break;case"dishes":if(t.name===void 0||t.name==="")throw new Error("菜品逻辑错误：菜品名称(name)不能为空");if(typeof t.price!="number"||t.price<0)throw new Error("菜品逻辑错误：菜品价格(price)必须为非负数");break;case"expenses":if(t.amount===void 0||typeof t.amount!="number"||t.amount<=0)throw new Error("支出逻辑错误：支出金额(amount)必须为正数");if(t.category===void 0||t.category==="")throw new Error("支出逻辑错误：支出类别(category)不能为空");if(t.description===void 0||t.description==="")throw new Error("支出逻辑错误：支出描述(description)不能为空");break;case"inventory":if(t.name===void 0||t.name==="")throw new Error("库存逻辑错误：库存名称(name)不能为空");if(typeof t.quantity!="number"||t.quantity<0)throw new Error("库存逻辑错误：库存数量(quantity)必须为非负数");if(t.unit===void 0||t.unit==="")throw new Error("库存逻辑错误：库存单位(unit)不能为空");break;case"hotel_rooms":if(t.roomNumber===void 0||t.roomNumber==="")throw new Error("酒店房间逻辑错误：房间号(roomNumber)不能为空");if(t.status===void 0||!["available","occupied","maintenance","cleaning"].includes(t.status))throw new Error("酒店房间逻辑错误：房间状态(status)必须为有效值");break;case"sign_bill_accounts":if(t.accountName===void 0||t.accountName==="")throw new Error("签单账户逻辑错误：账户名称(accountName)不能为空");if(typeof t.creditLimit!="number"||t.creditLimit<0)throw new Error("签单账户逻辑错误：信用额度(creditLimit)必须为非负数");break;case"partner_accounts":if(t.name_cn===void 0||t.name_cn==="")throw new Error("合作伙伴账户逻辑错误：单位中文名(name_cn)不能为空");if(t.name_en===void 0||t.name_en==="")throw new Error("合作伙伴账户逻辑错误：单位英文名(name_en)不能为空");if(t.contact_person===void 0||t.contact_person==="")throw new Error("合作伙伴账户逻辑错误：联系人(contact_person)不能为空");if(t.phone===void 0||t.phone==="")throw new Error("合作伙伴账户逻辑错误：联系电话(phone)不能为空");if(typeof t.credit_limit!="number"||t.credit_limit<0)throw new Error("合作伙伴账户逻辑错误：信用额度(credit_limit)必须为非负数");if(typeof t.current_balance!="number"||t.current_balance<0)throw new Error("合作伙伴账户逻辑错误：当前余额(current_balance)必须为非负数");break}}}class w{static create(r){switch(r.type){case"neon":try{const{NeonDatabase:t}=require("./neon-database");return new t(r)}catch{return console.warn("Neon数据库模块未找到，使用虚拟数据库作为后备"),new d}default:return console.info(`Using MemoryDatabase for type: ${r.type}`),new c}}}class a{static instance;database=null;constructor(){}static getInstance(){return a.instance||(a.instance=new a),a.instance}async initialize(r){this.database=w.create(r),await this.database.connect(),console.log(`Database initialized with type: ${r.type}`)}getDatabase(){if(!this.database)throw new Error("Database not initialized. Call initialize() first.");return this.database}async reconfigure(r){this.database&&await this.database.disconnect(),await this.initialize(r)}isInitialized(){return this.database!==null}}const h=a.getInstance();export{w as DatabaseFactory,a as DatabaseManager,c as MemoryDatabase,d as VirtualDatabase,h as dbManager};
