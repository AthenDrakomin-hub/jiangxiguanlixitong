import{jsx as e,jsxs as a}from"react/jsx-runtime";import{useState as n,useEffect as S}from"react";import{Plus as A,Building2 as b,User as F,Phone as j,CreditCard as q,DollarSign as E,X as D,Save as P,Edit3 as B,Trash2 as L}from"lucide-react";import{a as x}from"./index-CHj5k0ei.js";import"react-dom/client";const $=()=>{const[i,o]=n([]),[g,f]=n(!0),[N,u]=n(null),[v,m]=n(!1),[d,p]=n(null),[s,h]=n({name_cn:"",name_en:"",contact_person:"",phone:"",credit_limit:0,notes:""});S(()=>{y()},[]);const y=async()=>{try{f(!0);const t=await x.fetchCollection("partner_accounts");o(t)}catch(t){console.error("加载合作伙伴账户失败:",t),u("加载合作伙伴账户失败")}finally{f(!1)}},r=t=>{const{name:l,value:c}=t.target;h(z=>({...z,[l]:c}))},w=async t=>{t.preventDefault();try{if(d){const l=await x.update("partner_accounts",d.id,s);o(i.map(c=>c.id===d.id?{...c,...l}:c))}else{const l=await x.create("partner_accounts",s);o([...i,l])}h({name_cn:"",name_en:"",contact_person:"",phone:"",credit_limit:0,notes:""}),m(!1),p(null)}catch(l){console.error("保存合作伙伴账户失败:",l),u("保存合作伙伴账户失败")}},_=t=>{p(t),h({name_cn:t.name_cn,name_en:t.name_en,contact_person:t.contact_person,phone:t.phone,credit_limit:t.credit_limit,notes:t.notes}),m(!0)},k=async t=>{if(window.confirm("确定要删除这个合作伙伴账户吗？"))try{await x.remove("partner_accounts",t),o(i.filter(l=>l.id!==t))}catch(l){console.error("删除合作伙伴账户失败:",l),u("删除合作伙伴账户失败")}},C=()=>{p(null),h({name_cn:"",name_en:"",contact_person:"",phone:"",credit_limit:0,notes:""}),m(!0)};return g?e("div",{className:"flex h-64 items-center justify-center",children:e("div",{className:"h-8 w-8 animate-spin rounded-full border-b-2 border-slate-900"})}):a("div",{className:"space-y-6",children:[a("div",{className:"flex items-center justify-between",children:[a("div",{children:[e("h2",{className:"text-2xl font-bold text-slate-800",children:"合作单位管理"}),e("p",{className:"mt-1 text-sm text-slate-500",children:"管理可以挂账的合作单位信息"})]}),a("button",{onClick:C,className:"flex items-center gap-2 rounded-lg bg-slate-900 px-4 py-2 text-white hover:bg-slate-800",children:[e(A,{size:16}),"新增合作单位"]})]}),N&&e("div",{className:"rounded-lg border border-red-200 bg-red-50 p-4 text-red-700",children:N}),v&&a("div",{className:"rounded-xl border border-slate-100 bg-white p-6 shadow-sm",children:[e("h3",{className:"mb-4 text-lg font-bold text-slate-800",children:d?"编辑合作单位":"新增合作单位"}),a("form",{onSubmit:w,className:"space-y-4",children:[a("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[a("div",{children:[e("label",{className:"mb-1 block text-sm font-medium text-slate-700",children:"单位中文名 *"}),a("div",{className:"relative",children:[e(b,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:16}),e("input",{type:"text",name:"name_cn",value:s.name_cn||"",onChange:r,className:"w-full rounded-lg border border-slate-300 py-2 pl-10 pr-3",required:!0})]})]}),a("div",{children:[e("label",{className:"mb-1 block text-sm font-medium text-slate-700",children:"单位英文名 *"}),a("div",{className:"relative",children:[e(b,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:16}),e("input",{type:"text",name:"name_en",value:s.name_en||"",onChange:r,className:"w-full rounded-lg border border-slate-300 py-2 pl-10 pr-3",required:!0})]})]}),a("div",{children:[e("label",{className:"mb-1 block text-sm font-medium text-slate-700",children:"联系人 *"}),a("div",{className:"relative",children:[e(F,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:16}),e("input",{type:"text",name:"contact_person",value:s.contact_person||"",onChange:r,className:"w-full rounded-lg border border-slate-300 py-2 pl-10 pr-3",required:!0})]})]}),a("div",{children:[e("label",{className:"mb-1 block text-sm font-medium text-slate-700",children:"联系电话 *"}),a("div",{className:"relative",children:[e(j,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:16}),e("input",{type:"text",name:"phone",value:s.phone||"",onChange:r,className:"w-full rounded-lg border border-slate-300 py-2 pl-10 pr-3",required:!0})]})]}),a("div",{children:[e("label",{className:"mb-1 block text-sm font-medium text-slate-700",children:"信用额度 *"}),a("div",{className:"relative",children:[e(q,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:16}),e("input",{type:"number",name:"credit_limit",value:s.credit_limit||0,onChange:r,className:"w-full rounded-lg border border-slate-300 py-2 pl-10 pr-3",required:!0,min:"0"})]})]}),a("div",{children:[e("label",{className:"mb-1 block text-sm font-medium text-slate-700",children:"当前欠款"}),a("div",{className:"relative",children:[e(E,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:16}),e("input",{type:"number",value:d?.current_balance||0,className:"w-full rounded-lg border border-slate-300 py-2 pl-10 pr-3 bg-gray-100",readOnly:!0})]})]})]}),a("div",{children:[e("label",{className:"mb-1 block text-sm font-medium text-slate-700",children:"备注"}),e("textarea",{name:"notes",value:s.notes||"",onChange:r,className:"w-full rounded-lg border border-slate-300 py-2 px-3",rows:2})]}),a("div",{className:"flex justify-end gap-3",children:[a("button",{type:"button",onClick:()=>{m(!1),p(null)},className:"flex items-center gap-2 rounded-lg border border-slate-300 px-4 py-2 text-slate-700 hover:bg-slate-50",children:[e(D,{size:16}),"取消"]}),a("button",{type:"submit",className:"flex items-center gap-2 rounded-lg bg-slate-900 px-4 py-2 text-white hover:bg-slate-800",children:[e(P,{size:16}),"保存"]})]})]})]}),e("div",{className:"overflow-hidden rounded-xl border border-slate-100 bg-white shadow-sm",children:e("div",{className:"overflow-x-auto",children:a("table",{className:"min-w-full divide-y divide-slate-200",children:[e("thead",{className:"bg-slate-50",children:a("tr",{children:[e("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-slate-500",children:"单位名称"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-slate-500",children:"联系人"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-slate-500",children:"联系电话"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-slate-500",children:"信用额度"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-slate-500",children:"当前欠款"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-slate-500",children:"状态"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-slate-500",children:"操作"})]})}),e("tbody",{className:"divide-y divide-slate-200 bg-white",children:i.map(t=>a("tr",{className:"hover:bg-slate-50",children:[a("td",{className:"whitespace-nowrap px-6 py-4",children:[e("div",{className:"font-medium text-slate-900",children:t.name_cn}),e("div",{className:"text-sm text-slate-500",children:t.name_en})]}),e("td",{className:"whitespace-nowrap px-6 py-4 text-sm text-slate-500",children:t.contact_person}),e("td",{className:"whitespace-nowrap px-6 py-4 text-sm text-slate-500",children:t.phone}),a("td",{className:"whitespace-nowrap px-6 py-4 text-sm text-slate-500",children:["₱",t.credit_limit.toFixed(2)]}),a("td",{className:"whitespace-nowrap px-6 py-4 text-sm text-slate-500",children:["₱",t.current_balance.toFixed(2)]}),e("td",{className:"whitespace-nowrap px-6 py-4",children:e("span",{className:`inline-flex rounded-full px-2 text-xs font-semibold leading-5 ${t.status==="active"?"bg-green-100 text-green-800":t.status==="suspended"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:t.status==="active"?"启用":t.status==="suspended"?"暂停":"关闭"})}),e("td",{className:"whitespace-nowrap px-6 py-4 text-sm font-medium",children:a("div",{className:"flex items-center gap-2",children:[e("button",{onClick:()=>_(t),className:"text-slate-600 hover:text-slate-900",children:e(B,{size:16})}),e("button",{onClick:()=>k(t.id),className:"text-red-600 hover:text-red-900",children:e(L,{size:16})})]})})]},t.id))})]})})}),i.length===0&&a("div",{className:"rounded-lg border border-dashed border-slate-300 bg-slate-50 p-12 text-center",children:[e(b,{className:"mx-auto h-12 w-12 text-slate-400"}),e("h3",{className:"mt-2 text-sm font-medium text-slate-900",children:"暂无合作单位"}),e("p",{className:"mt-1 text-sm text-slate-500",children:'点击"新增合作单位"按钮创建第一个合作单位。'})]})]})};export{$ as default};
