import{j as e}from"./index-BV8Zipq2.js";import{r as c}from"./react-vendor-C14am9Lm.js";import{M as B,a6 as q,a7 as E,y,a8 as w,j as S,X as G,a9 as W,U as K,aa as Y,R as Q,ab as V,l as X,E as _,N as J,Q as Z,g as ee,W as C,C as se,x as te}from"./lucide-CwzgdtcU.js";import"./aws-sdk-BT5ufFbJ.js";import"./recharts-wRm9IGXD.js";const ce=({rooms:k,setRooms:o,dishes:M})=>{const[t,u]=c.useState(null),[I,d]=c.useState(!1),[h,p]=c.useState(!1),[m,b]=c.useState({guestName:""}),[g,A]=c.useState(new Date);c.useEffect(()=>{const s=setInterval(()=>A(new Date),6e4);return()=>clearInterval(s)},[]);const i=s=>{if(!s.currentSession)return{durationHours:0,roomFee:0,ordersFee:0,total:0};const a=new Date(s.currentSession.startTime).getTime(),l=(g.getTime()-a)/(1e3*60*60),x=Math.max(1,Math.ceil(l))*s.hourlyRate,N=s.currentSession.orders.reduce((H,v)=>H+v.price*v.quantity,0);return{durationHours:l,roomFee:x,ordersFee:N,total:x+N}},f=s=>{const a=new Date(s).getTime(),n=g.getTime(),l=Math.max(0,n-a),r=Math.floor(l/(1e3*60*60)),x=Math.floor(l%(1e3*60*60)/(1e3*60));return r>0?`${r}h ${x}m`:`${x}m`},T=s=>{u(s),b({guestName:""}),p(!1),d(!0)},U=()=>{!t||!m.guestName||(o(s=>s.map(a=>a.id===t.id?{...a,status:"InUse",currentSession:{guestName:m.guestName,startTime:new Date().toISOString(),orders:[]},currentSong:"Ready to play..."}:a)),d(!1))},z=()=>{p(!0)},D=s=>{if(!t||!t.currentSession)return;const a=i(t);o(n=>n.map(l=>l.id===t.id?{...l,status:"Cleaning",currentSession:void 0,currentSong:void 0}:l)),alert(`Checkout Success!
Method: ${s}
Amount: ₱${a.total.toFixed(2)}`),d(!1)},j=s=>{o(a=>a.map(n=>n.id===s?{...n,status:"Available"}:n)),(t==null?void 0:t.id)===s&&u(a=>a?{...a,status:"Available"}:null)},L=s=>{if(!t||!t.currentSession)return;const a=n=>{if(n.find(r=>r.dishId===s.id))return n.map(r=>r.dishId===s.id?{...r,quantity:r.quantity+1}:r);{const r={dishId:s.id,dishName:s.name,price:s.price,quantity:1};return[...n,r]}};o(n=>n.map(l=>l.id===t.id&&l.currentSession?{...l,currentSession:{...l.currentSession,orders:a(l.currentSession.orders)}}:l)),u(n=>!n||!n.currentSession?n:{...n,currentSession:{...n.currentSession,orders:a(n.currentSession.orders)}})},R=()=>{if(!t)return;const s=["Blue and White Porcelain","Legend of Phoenix","Ten Years","Monica","Last Dance","Sunny Day","King of Karaoke","Boundless Sea & Sky","Luxury Lady"],a=s[Math.floor(Math.random()*s.length)],n=l=>l.id===t.id?{...l,currentSong:a}:l;o(l=>l.map(n)),u(l=>l?{...l,currentSong:a}:null)},F=M.filter(s=>s.category==="酒水"||s.category==="特色菜"||s.category==="凉菜"),P=s=>{switch(s){case"Available":return"bg-emerald-500 border-emerald-500 text-white";case"InUse":return"bg-purple-600 border-purple-600 text-white";case"Cleaning":return"bg-orange-500 border-orange-500 text-white";case"Maintenance":return"bg-slate-500 border-slate-500 text-white"}},$=s=>{switch(s){case"Available":return"空闲 Available";case"InUse":return"使用中 In Use";case"Cleaning":return"待清理 Cleaning";case"Maintenance":return"维护中 Maint"}},O=[{id:"CASH",label:"现金",enLabel:"Cash",icon:_,color:"bg-green-100 text-green-700"},{id:"ALIPAY",label:"支付宝",enLabel:"AliPay",icon:J,color:"bg-blue-100 text-blue-600"},{id:"WECHAT",label:"微信",enLabel:"WeChat",icon:Z,color:"bg-emerald-100 text-emerald-600"},{id:"USDT",label:"USDT",enLabel:"USDT",icon:ee,color:"bg-teal-100 text-teal-600"},{id:"GCASH",label:"GCash",enLabel:"GCash",icon:C,color:"bg-blue-500 text-white"},{id:"MAYA",label:"Maya",enLabel:"Maya",icon:C,color:"bg-green-500 text-white"},{id:"SIGN_BILL",label:"挂账",enLabel:"Sign Bill",icon:se,color:"bg-yellow-100 text-yellow-700"}];return e.jsxs("div",{className:"space-y-6 animate-fade-in pb-20 md:pb-0",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(B,{className:"text-purple-600"})," KTV 智能操控台 (Console)"]}),e.jsx("p",{className:"text-slate-500 text-sm mt-1",children:"Room Management & Services"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm font-medium",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-emerald-500"})," 空闲 Avail"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-purple-600"})," 使用中 In Use"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-orange-400"})," 待清理 Cleaning"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-6",children:k.map(s=>e.jsxs("div",{onClick:()=>T(s),className:`
              relative rounded-xl border-2 transition-all cursor-pointer overflow-hidden group shadow-sm hover:shadow-md
              ${s.status==="Available"?"border-slate-200 bg-white hover:border-emerald-300":""}
              ${s.status==="InUse"?"border-purple-200 bg-purple-50 hover:border-purple-300":""}
              ${s.status==="Cleaning"?"border-orange-200 bg-orange-50 hover:border-orange-300":""}
              ${s.status==="Maintenance"?"border-slate-200 bg-slate-100 opacity-60":""}
            `,children:[e.jsx("div",{className:`absolute top-0 right-0 px-3 py-1 rounded-bl-xl text-xs font-bold ${P(s.status)}`,children:$(s.status)}),e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-800",children:s.name}),e.jsx("span",{className:"text-xs text-slate-400 px-2 py-1 bg-slate-100 rounded-lg",children:s.type})]}),e.jsxs("div",{className:"space-y-3 min-h-[80px]",children:[s.status==="Available"&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-slate-400 gap-2 py-4",children:[e.jsx(q,{size:32,className:"text-emerald-200"}),e.jsx("span",{className:"text-sm",children:"点击开台 Click to Open"})]}),s.status==="InUse"&&s.currentSession&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[e.jsx(E,{size:14,className:"text-purple-500"}),e.jsx("span",{children:s.currentSession.guestName})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[e.jsx(y,{size:14,className:"text-purple-500"}),e.jsxs("span",{children:["Used: ",f(s.currentSession.startTime)]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-purple-600 bg-purple-100 px-2 py-1 rounded w-fit",children:[e.jsx(w,{size:12}),e.jsx("span",{className:"truncate max-w-[120px]",children:s.currentSong})]})]}),s.status==="Cleaning"&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-slate-400 gap-2 py-4",children:[e.jsx(S,{size:32,className:"text-orange-200"}),e.jsx("button",{onClick:a=>{a.stopPropagation(),j(s.id)},className:"px-3 py-1 bg-orange-500 text-white rounded-lg text-sm hover:bg-orange-600",children:"完成清理 Done"})]})]})]}),e.jsxs("div",{className:"bg-slate-50 px-5 py-3 border-t border-slate-100 flex justify-between items-center",children:[e.jsxs("span",{className:"text-xs text-slate-500",children:["Rate: ₱",s.hourlyRate,"/h"]}),s.status==="InUse"&&e.jsxs("span",{className:"text-sm font-bold text-purple-600",children:["₱",i(s).total.toFixed(0)]})]})]},s.id))}),I&&t&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-5xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-4 md:p-6 border-b border-slate-100 flex justify-between items-center shrink-0",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-slate-800 flex items-center gap-3",children:[t.name," ",e.jsx("span",{className:"text-sm font-normal text-slate-500 bg-slate-100 px-2 py-0.5 rounded",children:t.type})]}),e.jsxs("p",{className:"text-xs text-slate-400",children:["Rate 费率: ₱",t.hourlyRate,"/Hour"]})]}),e.jsx("button",{onClick:()=>d(!1),className:"p-2 text-slate-400 hover:text-slate-600 bg-slate-100 rounded-full",children:e.jsx(G,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4 md:p-6",children:[t.status==="Available"&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-emerald-100 rounded-full flex items-center justify-center mb-6 text-emerald-600",children:e.jsx(W,{size:40})}),e.jsx("h4",{className:"text-2xl font-bold text-slate-800 mb-2",children:"准备开台 Ready to Open"}),e.jsx("p",{className:"text-slate-500 mb-8 max-w-xs",children:"Enter guest name to start timer."}),e.jsxs("div",{className:"w-full max-w-sm space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:20}),e.jsx("input",{type:"text",autoFocus:!0,placeholder:"Guest Name / 客人姓名",value:m.guestName,onChange:s=>b({guestName:s.target.value}),className:"w-full pl-10 pr-4 py-3 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500 text-lg"})]}),e.jsx("button",{onClick:U,disabled:!m.guestName,className:"w-full py-3 bg-emerald-600 text-white rounded-xl font-bold hover:bg-emerald-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-emerald-200",children:"立即开台 Open Session"})]})]}),t.status==="InUse"&&t.currentSession&&!h&&e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 lg:h-full",children:[e.jsxs("div",{className:"lg:w-1/3 space-y-4 shrink-0",children:[e.jsxs("div",{className:"bg-slate-900 text-white p-5 rounded-xl shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4 opacity-80",children:[e.jsx(y,{size:16}),e.jsxs("span",{children:["Duration 时长: ",f(t.currentSession.startTime)]})]}),e.jsxs("div",{className:"flex justify-between items-end mb-2",children:[e.jsx("span",{className:"text-slate-400",children:"Total Total"}),e.jsxs("span",{className:"text-3xl font-bold",children:["₱",i(t).total]})]}),e.jsxs("div",{className:"text-xs text-slate-500 flex justify-between border-t border-slate-700 pt-2 mt-2",children:[e.jsxs("span",{children:["Room 房费: ₱",i(t).roomFee]}),e.jsxs("span",{children:["Items 酒水: ₱",i(t).ordersFee]})]})]}),e.jsxs("div",{className:"bg-purple-50 p-5 rounded-xl border border-purple-100",children:[e.jsxs("h4",{className:"font-bold text-purple-900 mb-3 flex items-center gap-2",children:[e.jsx(w,{size:18})," Playing 正在播放"]}),e.jsxs("div",{className:"flex items-center justify-between bg-white p-3 rounded-lg border border-purple-100 mb-3",children:[e.jsx("span",{className:"font-medium text-slate-700",children:t.currentSong}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"w-1 h-4 bg-purple-400 rounded-full animate-pulse"}),e.jsx("span",{className:"w-1 h-4 bg-purple-400 rounded-full animate-pulse delay-75"}),e.jsx("span",{className:"w-1 h-4 bg-purple-400 rounded-full animate-pulse delay-150"})]})]}),e.jsxs("button",{onClick:R,className:"w-full py-2 bg-purple-200 text-purple-800 rounded-lg hover:bg-purple-300 transition-colors flex items-center justify-center gap-2 text-sm font-bold",children:[e.jsx(Y,{size:16})," Skip Song 切歌"]})]}),e.jsxs("div",{className:"bg-white border border-slate-200 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"bg-slate-50 px-4 py-2 border-b border-slate-100 text-xs font-bold text-slate-500 uppercase",children:["Orders (",t.currentSession.orders.length,")"]}),e.jsx("div",{className:"max-h-48 overflow-y-auto p-2",children:t.currentSession.orders.length===0?e.jsx("div",{className:"text-center py-4 text-slate-400 text-sm",children:"No items ordered"}):t.currentSession.orders.map((s,a)=>e.jsxs("div",{className:"flex justify-between items-center p-2 text-sm border-b border-slate-50 last:border-0",children:[e.jsxs("span",{className:"text-slate-700",children:[s.dishName," x",s.quantity]}),e.jsxs("span",{className:"font-medium text-slate-900",children:["₱",s.price*s.quantity]})]},a))})]}),e.jsxs("button",{onClick:z,className:"w-full py-3 bg-red-600 text-white rounded-xl font-bold hover:bg-red-700 shadow-lg shadow-red-200 flex items-center justify-center gap-2",children:[e.jsx(Q,{size:18})," Checkout 结账"]})]}),e.jsxs("div",{className:"flex-1 bg-slate-50 rounded-xl p-4 border border-slate-200 flex flex-col",children:[e.jsxs("h4",{className:"font-bold text-slate-800 mb-4 flex items-center gap-2",children:[e.jsx(V,{size:18})," Add Drinks/Snacks 加点酒水"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 overflow-y-auto pr-1 flex-1 max-h-[400px]",children:F.map(s=>e.jsxs("button",{onClick:()=>L(s),className:"bg-white p-3 rounded-lg border border-slate-200 hover:border-purple-400 hover:shadow-md transition-all text-left flex flex-col gap-2 group",children:[e.jsxs("div",{className:"aspect-video bg-slate-100 rounded-md overflow-hidden relative",children:[e.jsx("img",{src:s.imageUrl,alt:s.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors flex items-center justify-center",children:e.jsx(X,{className:"text-white opacity-0 group-hover:opacity-100 scale-0 group-hover:scale-100 transition-all drop-shadow-md",size:24})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-slate-800 text-sm line-clamp-1",children:s.name}),e.jsxs("div",{className:"text-purple-600 font-bold text-sm",children:["₱",s.price]})]})]},s.id))})]})]}),t.status==="InUse"&&h&&e.jsxs("div",{className:"text-center py-6",children:[e.jsx("button",{onClick:()=>p(!1),className:"absolute top-6 left-6 text-slate-400 hover:text-slate-600 flex items-center gap-1 text-sm font-medium",children:"← Back 返回"}),e.jsxs("h3",{className:"text-2xl font-bold text-slate-800 mb-2",children:["收银台 Cashier - ",t.name]}),e.jsx("p",{className:"text-slate-500 mb-8",children:"Select Payment Method 选择支付方式"}),e.jsxs("div",{className:"text-5xl font-bold text-slate-900 mb-10",children:["₱",i(t).total.toFixed(0)]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 max-w-2xl mx-auto",children:O.map(s=>{const a=s.icon;return e.jsxs("button",{onClick:()=>D(s.id),className:`flex flex-col items-center justify-center p-6 rounded-xl border-2 transition-all ${s.color} border-transparent hover:border-slate-300 hover:scale-[1.02] shadow-sm`,children:[e.jsx(a,{size:32,className:"mb-3 opacity-90"}),e.jsxs("div",{className:"text-center leading-tight",children:[e.jsx("span",{className:"font-bold text-sm block",children:s.label}),e.jsx("span",{className:"text-xs opacity-75",children:s.enLabel})]})]},s.id)})})]}),t.status==="Cleaning"&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"w-20 h-20 bg-orange-100 rounded-full flex items-center justify-center mb-6 text-orange-600 animate-pulse",children:e.jsx(S,{size:40})}),e.jsx("h4",{className:"text-2xl font-bold text-slate-800 mb-2",children:"Cleaning 房间清理中"}),e.jsx("p",{className:"text-slate-500 mb-8",children:"Please arrange cleaning staff."}),e.jsxs("button",{onClick:()=>{j(t.id),d(!1)},className:"px-8 py-3 bg-slate-800 text-white rounded-xl font-bold hover:bg-slate-900 transition-colors flex items-center gap-2",children:[e.jsx(te,{size:20}),"Mark as Cleaned 标记清理完毕"]})]})]})})]})})]})};export{ce as default};
