import{jsxs as a,jsx as e}from"react/jsx-runtime";import{useState as u}from"react";import{X as j,Plus as z,PackageCheck as L,AlertTriangle as S,PackageX as E,Search as O,Edit2 as $,Trash2 as M}from"lucide-react";import{a as g}from"./index-CHj5k0ei.js";import{a as f}from"./auditLogger-DYWE_lBP.js";import"react-dom/client";const _=({inventory:o,setInventory:h})=>{const[N,T]=u(""),[D,x]=u(!1),[c,y]=u(null),[v,r]=u(null),[d,i]=u({name:"",quantity:0,unit:"kg",threshold:5}),p=o.filter(t=>t.quantity<=t.threshold),w=t=>{t?(y(t),i(t)):(y(null),i({name:"",quantity:0,unit:"kg",threshold:5})),x(!0)},q=async t=>{const s=o.find(l=>l.id===t);if(s&&confirm("Delete this item? 确定要删除该食材记录吗？"))try{await g.remove("inventory",t),h(l=>l.filter(n=>n.id!==t)),f.log("warn","INVENTORY_DELETE",`删除食材: ${s.name}`,"admin"),r(null)}catch(l){r("删除失败: "+(l instanceof Error?l.message:"未知错误"))}},A=async t=>{t.preventDefault();const s=new Date().toISOString();try{if(c){const l={...c,...d,updatedAt:s};await g.update("inventory",c.id,l),h(n=>n.map(m=>m.id===c.id?l:m)),f.log("info","INVENTORY_UPDATE",`更新食材: ${l.name}`,"admin")}else{const l={...d,id:`ING-${Date.now()}`,updatedAt:s};await g.create("inventory",l),h(n=>[l,...n]),f.log("info","INVENTORY_CREATE",`添加食材: ${l.name}`,"admin")}x(!1),r(null)}catch(l){r("保存失败: "+(l instanceof Error?l.message:"未知错误"))}},k=async(t,s)=>{try{const l=o.find(b=>b.id===t);if(!l)return;const n=Math.max(0,l.quantity+s),m={...l,quantity:n,updatedAt:new Date().toISOString()};await g.update("inventory",t,m),h(b=>b.map(C=>C.id===t?m:C)),f.log("info","INVENTORY_ADJUST",`库存调整: ${l.name} ${s>0?"+":""}${s} ${l.unit}`,"admin"),r(null)}catch(l){r("库存调整失败: "+(l instanceof Error?l.message:"未知错误"))}},I=o.filter(t=>t.name.toLowerCase().includes(N.toLowerCase()));return a("div",{className:"animate-fade-in space-y-6",children:[v&&e("div",{className:"rounded-lg border border-red-200 bg-red-50 p-4 text-red-700",children:a("div",{className:"flex items-center gap-2",children:[e(j,{size:18}),e("span",{className:"font-medium",children:v})]})}),a("div",{className:"flex flex-col items-start justify-between gap-4 sm:flex-row sm:items-center",children:[a("div",{children:[e("h2",{className:"text-2xl font-bold text-slate-800",children:"Inventory 库存管理"}),e("p",{className:"text-sm text-slate-500",children:"Pamamahala ng Imbentaryo"})]}),a("button",{onClick:()=>w(),className:"flex items-center gap-2 rounded-lg bg-slate-900 px-4 py-2 text-white shadow-lg shadow-slate-900/20 transition-colors hover:bg-slate-800",children:[e(z,{size:20}),e("span",{children:"Add Item / Magdagdag"})]})]}),a("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-3",children:[a("div",{className:"flex items-center justify-between rounded-xl border border-slate-100 bg-white p-6 shadow-sm",children:[a("div",{children:[e("p",{className:"text-sm font-medium text-slate-500",children:"Total Items / Kabuuan"}),e("h3",{className:"mt-1 text-2xl font-bold text-slate-800",children:o.length})]}),e("div",{className:"rounded-lg bg-blue-50 p-3 text-blue-600",children:e(L,{size:24})})]}),a("div",{className:"flex items-center justify-between rounded-xl border border-slate-100 bg-white p-6 shadow-sm",children:[a("div",{children:[e("p",{className:"text-sm font-medium text-slate-500",children:"Low Stock / Mababa ang stock"}),e("h3",{className:`mt-1 text-2xl font-bold ${p.length>0?"text-red-600":"text-slate-800"}`,children:p.length})]}),e("div",{className:`rounded-lg p-3 ${p.length>0?"animate-pulse bg-red-50 text-red-600":"bg-green-50 text-green-600"}`,children:e(S,{size:24})})]}),a("div",{className:"flex items-center justify-between rounded-xl border border-slate-100 bg-white p-6 shadow-sm",children:[a("div",{children:[e("p",{className:"text-sm font-medium text-slate-500",children:"Status / Kalagayan"}),e("h3",{className:"mt-1 text-xl font-bold text-slate-800",children:p.length>0?"Need Restock 需补货":"Good 充足"})]}),e("div",{className:"rounded-lg bg-slate-100 p-3 text-slate-600",children:e(E,{size:24})})]})]}),a("div",{className:"overflow-hidden rounded-xl border border-slate-100 bg-white shadow-sm",children:[e("div",{className:"flex flex-col items-center justify-between gap-4 border-b border-slate-100 p-6 sm:flex-row",children:a("div",{className:"relative w-full sm:w-72",children:[e(O,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:20}),e("input",{type:"text",placeholder:"Search / 搜索 / Hanapin...",value:N,onChange:t=>T(t.target.value),className:"w-full rounded-lg border border-slate-200 py-2 pl-10 pr-4 focus:outline-none focus:ring-2 focus:ring-slate-900"})]})}),a("div",{className:"overflow-x-auto",children:[a("table",{className:"w-full text-left",children:[e("thead",{className:"bg-slate-50 text-sm text-slate-500",children:a("tr",{children:[e("th",{className:"px-6 py-4 font-medium",children:"Name / Pangalan"}),e("th",{className:"px-6 py-4 font-medium",children:"Stock / Imbentaryo"}),e("th",{className:"px-6 py-4 font-medium",children:"Threshold / Limit"}),e("th",{className:"px-6 py-4 font-medium",children:"Status / Kalagayan"}),e("th",{className:"px-6 py-4 font-medium",children:"Updated"}),e("th",{className:"px-6 py-4 text-right font-medium",children:"Action"})]})}),e("tbody",{className:"divide-y divide-slate-100",children:I.map(t=>{const s=t.quantity<=t.threshold;return a("tr",{className:"transition-colors hover:bg-slate-50",children:[e("td",{className:"px-6 py-4 font-medium text-slate-800",children:t.name}),e("td",{className:"px-6 py-4",children:a("div",{className:"flex items-center gap-3",children:[a("span",{className:"min-w-[3rem] font-bold text-slate-700",children:[t.quantity," ",e("span",{className:"text-xs font-normal text-slate-400",children:t.unit})]}),a("div",{className:"flex items-center gap-1",children:[e("button",{onClick:()=>k(t.id,-1),className:"flex h-6 w-6 items-center justify-center rounded bg-slate-100 text-slate-600 hover:bg-slate-200",children:"-"}),e("button",{onClick:()=>k(t.id,1),className:"flex h-6 w-6 items-center justify-center rounded bg-slate-100 text-slate-600 hover:bg-slate-200",children:"+"})]})]})}),a("td",{className:"px-6 py-4 text-slate-500",children:[t.threshold," ",t.unit]}),e("td",{className:"px-6 py-4",children:s?a("span",{className:"inline-flex items-center gap-1 rounded-full bg-red-100 px-2.5 py-0.5 text-xs font-medium text-red-700",children:[e(S,{size:12})," Low / Mababa"]}):e("span",{className:"inline-flex items-center rounded-full bg-green-100 px-2.5 py-0.5 text-xs font-medium text-green-700",children:"OK 充足"})}),e("td",{className:"px-6 py-4 text-sm text-slate-400",children:new Date(t.updatedAt).toLocaleDateString()}),e("td",{className:"px-6 py-4 text-right",children:a("div",{className:"flex items-center justify-end gap-2",children:[e("button",{onClick:()=>w(t),className:"rounded-lg p-2 text-slate-400 hover:bg-slate-100 hover:text-slate-600",children:e($,{size:16})}),e("button",{onClick:()=>q(t.id),className:"rounded-lg p-2 text-slate-400 hover:bg-red-50 hover:text-red-600",children:e(M,{size:16})})]})})]},t.id)})})]}),I.length===0&&a("div",{className:"flex flex-col items-center gap-3 p-12 text-center text-slate-400",children:[e(E,{size:48,className:"text-slate-200"}),e("p",{children:"No Items Found / Walang nakita"})]})]})]}),D&&e("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:a("div",{className:"w-full max-w-md rounded-2xl bg-white p-6",children:[a("div",{className:"mb-6 flex items-center justify-between",children:[e("h3",{className:"text-xl font-bold text-slate-800",children:c?"Edit Item / I-edit":"Add Item / Magdagdag"}),e("button",{onClick:()=>x(!1),className:"text-slate-400 hover:text-slate-600",children:"×"})]}),a("form",{onSubmit:A,className:"space-y-4",children:[a("div",{children:[e("label",{className:"mb-1 block text-sm font-medium text-slate-700",children:"Name / Pangalan"}),e("input",{type:"text",required:!0,value:d.name,onChange:t=>i(s=>({...s,name:t.target.value})),className:"w-full rounded-lg border border-slate-200 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-slate-900",placeholder:"e.g. Beef / 牛肉"})]}),a("div",{className:"grid grid-cols-2 gap-4",children:[a("div",{children:[e("label",{className:"mb-1 block text-sm font-medium text-slate-700",children:"Quantity / Dami"}),e("input",{type:"number",required:!0,min:"0",step:"0.1",value:d.quantity,onChange:t=>i(s=>({...s,quantity:Number(t.target.value)})),className:"w-full rounded-lg border border-slate-200 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-slate-900"})]}),a("div",{children:[e("label",{className:"mb-1 block text-sm font-medium text-slate-700",children:"Unit / Yunit"}),e("input",{type:"text",required:!0,value:d.unit,onChange:t=>i(s=>({...s,unit:t.target.value})),className:"w-full rounded-lg border border-slate-200 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-slate-900",placeholder:"kg/pack"})]})]}),a("div",{children:[e("label",{className:"mb-1 block text-sm font-medium text-slate-700",children:"Alert Threshold / Limitasyon"}),a("div",{className:"relative",children:[e("input",{type:"number",required:!0,min:"0",value:d.threshold,onChange:t=>i(s=>({...s,threshold:Number(t.target.value)})),className:"w-full rounded-lg border border-slate-200 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-slate-900"}),e("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-xs text-slate-400",children:"Alert level"})]})]}),a("div",{className:"flex gap-3 pt-4",children:[e("button",{type:"button",onClick:()=>x(!1),className:"flex-1 rounded-lg py-2 text-slate-600 transition-colors hover:bg-slate-100",children:"Cancel / Kanselahin"}),e("button",{type:"submit",className:"flex-1 rounded-lg bg-slate-900 py-2 font-medium text-white shadow-lg shadow-slate-900/10 transition-colors hover:bg-slate-800",children:"Save / I-save"})]})]})]})})]})};export{_ as default};
